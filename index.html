<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <!-- [IMPORTANTE] Viewport tag para responsive -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="https://i.postimg.cc/tghfjHJm/Favicon.png">
    <title>Addly</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css" rel="stylesheet" />

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            overflow-x: hidden; /* Mantiene el body sin scroll horizontal */
        }
        html {
            scroll-behavior: smooth;
            overflow-x: hidden; /* Mantiene el html sin scroll horizontal */
        }
        .section-container {
            display: none;
        }
        .section-container.active {
            display: block;
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .invalid-field {
            border-color: #ef4444; /* red-500 */
            --tw-ring-color: #ef4444;
        }
        .highlight-finish-btn {
            animation: glow 2.5s ease-in-out;
        }
        @keyframes glow {
            0% { box-shadow: 0 0 0px #60a5fa; } /* blue-400 */
            50% { box-shadow: 0 0 25px 8px #60a5fa; }
            100% { box-shadow: 0 0 0px #60a5fa; }
        }
        .toggle-checkbox:checked {
            right: 0;
            border-color: #2563eb; /* blue-600 */
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #2563eb; /* blue-600 */
        }
        #success-modal-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        #success-modal-box {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }

        /* Timeline Styles */
        .timeline-item {
            position: relative;
            padding-bottom: 2.5rem;
            text-align: center;
            padding-left: 1rem;
            padding-right: 1rem;
            /* [CAMBIO] Añadido fondo blanco para tapar la línea vertical en móvil */
            background-color: #ffffff;
        }
        .timeline-item:before {
            content: '';
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            top: 3rem;
            bottom: -0.5rem;
            width: 2px;
            background-color: #d1d5db; /* gray-300 */
            z-index: 0; /* [CAMBIO] Pone la línea en el 'piso' del stacking context */
        }
        .timeline-item:last-child:before {
            display: none;
        }
        .timeline-dot {
            position: relative;
            /* [CAMBIO] Añadido z-10 para que el punto también esté sobre la línea */
            z-index: 10;
            left: auto;
            top: auto;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px;
            background-color: #2563eb; /* blue-600 */
            color: white;
            font-weight: bold;
            font-size: 1rem;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 1rem;
        }
        @media (min-width: 768px) {
            .timeline-container {
                position: relative;
                width: 100%;
                display: flex;
                justify-content: space-between;
                margin-top: 2rem;
            }
            .timeline-container:before {
                content: '';
                position: absolute;
                top: 0.6rem;
                left: 5%;
                right: 5%;
                height: 2px;
                background-color: #d1d5db; /* gray-300 */
                z-index: 0;
            }
            .timeline-item {
                position: relative;
                width: 30%;
                padding-left: 0;
                padding-right: 0;
                padding-top: 3.5rem;
                padding-bottom: 0;
                text-align: center;
            }
            .timeline-item:before {
                 display: none;
            }
             .timeline-dot {
                position: absolute;
                left: 50%;
                top: 0;
                transform: translateX(-50%);
                z-index: 1;
                width: 1.5rem;
                height: 1.5rem;
                margin-bottom: 0;
                font-size: 0.875rem;
            }
        }

        /* Activity Feed */
        #activity-feed {
            font-size: 1.125rem;
            color: #d1d5db; /* gray-300 */
        }
        #activity-feed span {
            display: inline-block;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Marquee Styles */
        .marquee-wrapper {
            /* [CAMBIO CLAVE] Revertido a 'hidden'. 'auto' rompía el layout de toda la página en móvil. */
            overflow-x: hidden;
            position: relative;
            width: 100%;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .marquee-wrapper::-webkit-scrollbar {
            display: none;
        }

        .marquee-content {
            display: flex;
            width: max-content;
            animation: marquee 20s linear infinite;
        }

        /* Pause animation on hover/touch */
        .marquee-wrapper:hover .marquee-content,
        .marquee-wrapper:focus-within .marquee-content {
            animation-play-state: paused;
        }

        @media (min-width: 768px) {
            .marquee-content {
                animation-duration: 30s;
            }
        }

        .marquee-content img {
            padding-left: 1.5rem;
            padding-right: 1.5rem;
            flex-shrink: 0;
        }
         .marquee-gallery img {
            max-width: 400px;
            height: auto;
        }

        @keyframes marquee {
            0% { transform: translateX(0%); }
            100% { transform: translateX(-50%); }
        }
    </style>
</head>
<body class="bg-white">

    <!-- Modal de Éxito -->
    <div id="success-modal-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden opacity-0">
        <div id="success-modal-box" class="bg-white rounded-2xl shadow-xl p-8 max-w-sm w-full text-center transform scale-95 opacity-0">
            <div class="mx-auto flex items-center justify-center h-20 w-20 rounded-full bg-green-100 mb-4">
                <svg class="h-12 w-12 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
            </div>
            <h3 id="modal-title" class="text-2xl font-bold text-gray-800 mb-2">¡Éxito!</h3>
            <p id="modal-message" class="text-gray-600 mb-6">La operación se completó correctamente.</p>
            <button id="modal-close-btn" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300">
                Entendido
            </button>
        </div>
    </div>

    <!-- CTA Flotante (Sticky) para Móvil -->
    <div id="floating-cta-mobile" class="md:hidden fixed bottom-0 left-0 right-0 bg-white p-4 z-40 border-t border-gray-200 shadow-lg">
        <a href="#cotizador" class="w-full bg-yellow-400 text-gray-900 font-bold py-3 px-4 text-sm rounded-lg hover:bg-yellow-500 transition-colors block text-center">
            LANZA TU CAMPAÑA AHORA
        </a>
    </div>

    <!-- CTA Flotante (Sticky) para Desktop -->
    <div id="floating-cta-desktop" class="hidden md:block fixed bottom-8 right-8 z-40 transform transition-transform duration-300 hover:scale-105">
        <a href="#cotizador" class="bg-yellow-400 text-gray-900 font-bold py-4 px-8 text-lg rounded-lg hover:bg-yellow-500 transition-colors shadow-2xl">
            LANZA TU CAMPAÑA AHORA
        </a>
    </div>

    <div id="initial-view">
        <!-- Navegación Rediseñada -->
        <header class="bg-white shadow-md sticky top-0 z-40">
            <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
                <div>
                     <img src="https://i.postimg.cc/LsTK3hF9/logo-gen-camp.png" alt="Logo Addly" class="h-12">
                </div>
                <div class="hidden md:flex items-center space-x-4">
                    <a href="#" id="register-driver-nav" class="text-white bg-green-500 hover:bg-green-600 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-colors">
                        Gana Dinero Conduciendo
                    </a>

                    <button id="dropdown-register-button" data-dropdown-toggle="dropdown-register" class="text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center" type="button">
                        Socios
                        <svg class="w-2.5 h-2.5 ms-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"/>
                        </svg>
                    </button>

                    <div id="dropdown-register" class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow w-44">
                        <ul class="py-2 text-sm text-gray-700" aria-labelledby="dropdown-register-button">
                          <li>
                            <a href="#" id="register-graph-nav" class="block px-4 py-2 hover:bg-gray-100">Taller Gráfico</a>
                          </li>
                          <li>
                            <a href="#cotizador" class="block px-4 py-2 hover:bg-gray-100">Publicitar mi marca (Gratis)</a>
                          </li>
                        </ul>
                    </div>
                </div>
                 <button id="mobile-menu-button" class="md:hidden flex items-center">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </nav>

            <!-- Menú Móvil -->
            <div id="mobile-menu" class="md:hidden hidden px-6 pt-2 pb-4 space-y-2 border-t">
                <a href="#" id="register-driver-nav-mobile" class="block text-green-600 font-bold hover:bg-green-50 p-2 rounded-lg">Gana Dinero Conduciendo</a>
                <a href="#" id="register-graph-nav-mobile" class="block text-gray-800 font-medium hover:bg-gray-100 p-2 rounded-lg">Registrarse como Taller</a>
                <a href="#cotizador" class="block text-gray-800 font-medium hover:bg-gray-100 p-2 rounded-lg">Cotiza tu Campaña</a>
            </div>
        </header>

        <main>

            <!-- SECCIÓN 1: HERO OPTIMIZADO -->
            <section class="relative h-screen flex items-center justify-center">

                <!-- Fondo de Carrusel -->
                <div class="absolute inset-0 w-full h-full z-0" data-carousel="slide" data-carousel-interval="3000">
                    <div class="relative h-full overflow-hidden">
                        <!-- Items ... -->
                         <div class="hidden duration-1000 ease-in-out" data-carousel-item>
                            <img src="https://i.postimg.cc/wBC7QySr/1.jpg" class="absolute block w-full h-full object-cover" alt="Carrusel 1">
                        </div>
                        <div class="hidden duration-1000 ease-in-out" data-carousel-item>
                            <img src="https://i.postimg.cc/PqgPQpBc/2.jpg" class="absolute block w-full h-full object-cover" alt="Carrusel 2">
                        </div>
                        <div class="hidden duration-1000 ease-in-out" data-carousel-item>
                            <img src="https://i.postimg.cc/bJ1dCYh3/3.jpg" class="absolute block w-full h-full object-cover" alt="Carrusel 3">
                        </div>
                        <div class="hidden duration-1000 ease-in-out" data-carousel-item>
                            <img src="https://i.postimg.cc/SscjTQhV/4.jpg" class="absolute block w-full h-full object-cover" alt="Carrusel 4">
                        </div>
                        <div class="hidden duration-1000 ease-in-out" data-carousel-item>
                            <img src="https://i.postimg.cc/R0kNL6jw/5.jpg" class="absolute block w-full h-full object-cover" alt="Carrusel 5">
                        </div>
                        <div class="hidden duration-1000 ease-in-out" data-carousel-item>
                            <img src="https://i.postimg.cc/BvrXBLdw/6.jpg" class="absolute block w-full h-full object-cover" alt="Carrusel 6">
                        </div>
                        <div class="hidden duration-1000 ease-in-out" data-carousel-item>
                            <img src="https://i.postimg.cc/SKBJf2w3/7.jpg" class="absolute block w-full h-full object-cover" alt="Carrusel 7">
                        </div>
                    </div>
                </div>

                <div class="absolute inset-0 bg-black bg-opacity-60 z-10"></div>

                <div class="relative container mx-auto px-6 text-center text-white z-20">
                    <h1 class="text-4xl md:text-6xl font-extrabold leading-tight">¡ALCANCE GARANTIZADO!</h1>
                    <p class="mt-4 text-2xl md:text-4xl font-light max-w-3xl mx-auto">TU MARCA VISTA POR MÁS DE <span class="font-bold text-yellow-400">1.000.000</span> DE PERSONAS AL MES.</p>

                    <div class="mt-6 text-center">
                        <span class="text-lg md:text-xl text-gray-300">Impactos generados hoy:</span>
                        <div id="impact-counter" class="text-4xl md:text-5xl font-bold text-white mt-2">0</div>
                    </div>

                    <a href="#" id="scroll-arrow" class="absolute bottom-20 md:bottom-2 left-1/2 -translate-x-1/2 z-20 text-white cursor-pointer">
                        <svg class="w-8 h-8 animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7"></path></svg>
                    </a>
            </section>

            <!-- SECCIÓN 2: SOCIOS DE MARCA -->
            <section id="marcas" class="py-10 bg-gray-900 relative z-30 -mt-24 rounded-t-2xl">
                 <!-- [CAMBIO] Añadido 'overflow-hidden' para forzar el corte de la marquesina en móviles -->
                 <div class="container mx-auto px-6 text-center overflow-hidden">
                    <h2 class="text-xl font-semibold text-gray-300 mb-8">Marcas que confían en nosotros para rodar su mensaje</h2>
                    <div class="marquee-wrapper">
                        <div class="marquee-content">
                            <!-- Logos -->
                            <img src="https://i.postimg.cc/NjVGBKD9/Secci-n-Socios-de-marca-20251015-193216-0000.jpg" alt="Socio 1" class="h-10 mx-auto transition-all">
                            <img src="https://i.postimg.cc/rwzyB11r/Secci-n-Socios-de-marca-20251015-193216-0001.jpg" alt="Socio 2" class="h-10 mx-auto transition-all">
                            <img src="https://i.postimg.cc/wj3xCXXR/Secci-n-Socios-de-marca-20251015-193217-0002.jpg" alt="Socio 3" class="h-10 mx-auto transition-all">
                            <img src="https://i.postimg.cc/YCj2566G/Secci-n-Socios-de-marca-20251015-193217-0003.jpg" alt="Socio 4" class="h-10 mx-auto transition-all">
                            <img src="https://i.postimg.cc/4N9PP0xJ/5.jpg" alt="Socio 5" class="h-10 mx-auto transition-all">
                            <img src="https://i.postimg.cc/65vccPpp/6.jpg" alt="Socio 6" class="h-10 mx-auto transition-all">
                            <!-- Duplicados -->
                            <img src="https://i.postimg.cc/NjVGBKD9/Secci-n-Socios-de-marca-20251015-193216-0000.jpg" alt="Socio 1" class="h-10 mx-auto transition-all">
                            <img src="https://i.postimg.cc/rwzyB11r/Secci-n-Socios-de-marca-20251015-193216-0001.jpg" alt="Socio 2" class="h-10 mx-auto transition-all">
                            <img src="https://i.postimg.cc/wj3xCXXR/Secci-n-Socios-de-marca-20251015-193217-0002.jpg" alt="Socio 3" class="h-10 mx-auto transition-all">
                            <img src="https://i.postimg.cc/YCj2566G/Secci-n-Socios-de-marca-20251015-193217-0003.jpg" alt="Socio 4" class="h-10 mx-auto transition-all">
                            <img src="https://i.postimg.cc/4N9PP0xJ/5.jpg" alt="Socio 5" class="h-10 mx-auto transition-all">
                            <img src="https://i.postimg.cc/65vccPpp/6.jpg" alt="Socio 6" class="h-10 mx-auto transition-all">
                        </div>
                    </div>
                 </div>
            </section>

            <!-- SECCIÓN 3: NUESTROS 3 PILARES -->
            <section class="py-16 bg-white">
                <div class="container mx-auto px-6 text-center">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">¿Cansado de vallas publicitarias que nadie puede medir?</h2>
                    <p class="text-lg text-gray-600 max-w-3xl mx-auto mb-12">Rompemos con la publicidad tradicional. Te damos control total, logística sin esfuerzo y verificación en tiempo real.</p>
                    <div class="grid md:grid-cols-3 gap-12">
                        <div class="text-center">
                             <div class="flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 text-blue-600 mx-auto mb-4">
                                <svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 6.75V15m0 0v2.25m0-2.25h1.5M9 15h1.5m-1.5 0H5.625c-.621 0-1.125.504-1.125 1.125v2.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V16.125c0-.621-.504-1.125-1.125-1.125h-1.5M12 9v6.75m0 0h-1.5M12 9h1.5m0 0H9m1.5 0H12m0 0V6.75m0 0h.008v.008H12V6.75zm.008 0H12m0 0h.008v.008H12V6.75zm.008 0h.008v.008h-.008V6.75zm.008 0h.008v.008h-.008V6.75zm-.008 0H12v.008h.008V6.75zM12 9h.008v.008H12V9zm.008 0h.008v.008h-.008V9zm.008 0h.008v.008h-.008V9zm-.008 0H12v.008h.008V9z" />
                                </svg>
                            </div>
                            <h3 class="text-xl font-semibold mb-2">Alcance Medible</h3>
                            <p class="font-semibold text-gray-700 mb-2">Diseña tu Ruta y Cobertura</p>
                            <p class="text-gray-600">No más adivinanzas. Selecciona tus Zonas de Interés y mide cada impacto. Nosotros asignamos la flota ideal para tu objetivo.</p>
                        </div>
                        <div class="text-center">
                            <div class="flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 text-blue-600 mx-auto mb-4">
                                <svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" />
                                </svg>
                             </div>
                            <h3 class="text-xl font-semibold mb-2">Logística Sin Esfuerzo</h3>
                            <p class="font-semibold text-gray-700 mb-2">Producción y Montaje Incluido</p>
                            <p class="text-gray-600">Nuestro equipo de socios gráficos se encarga de la fabricación y la aplicación profesional. Tu publicidad se instala rápido y con calidad garantizada.</p>
                        </div>
                        <div class="text-center">
                            <div class="flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 text-blue-600 mx-auto mb-4">
                                <svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75" />
                                </svg>
                             </div>
                            <h3 class="text-xl font-semibold mb-2">Verificación Constante</h3>
                             <p class="font-semibold text-gray-700 mb-2">Resultados en Vivo y Sin Sorpresas</p>
                            <p class="text-gray-600">Accede a reportes detallados y fotos de verificación. Te garantizamos que tu mensaje sigue en la calle, generando impacto real cada día.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECCIÓN 4: CALCULADORA DE IMPACTO -->
            <section class="py-20 bg-gray-50">
                <div class="container mx-auto px-6">
                    <div class="max-w-2xl mx-auto">
                        <div class="bg-white p-8 rounded-2xl shadow-xl border border-gray-200">
                            <div class="text-center md:text-left mb-6">
                                <h2 class="text-3xl font-bold text-gray-800 mb-4">Simula tu Impacto al Instante</h2>
                                <p class="text-lg text-gray-600">Descubre el alcance potencial de tu marca.</p>
                            </div>
                            <div class="grid grid-cols-1 gap-6">
                                <div>
                                    <label for="calc-vehicle" class="block text-gray-600 font-medium mb-2">Vehículo</label>
                                    <select id="calc-vehicle" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
                                        <option value="1.0">Auto/Camioneta</option>
                                        <option value="0.5">Moto</option>
                                        <option value="0.3">Bici</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="calc-months" class="block text-gray-600 font-medium mb-2">Meses de Campaña</label>
                                    <select id="calc-months" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
                                        <option value="1" selected>1 Mes</option>
                                        <option value="2">2 Meses</option>
                                        <option value="3">3 Meses</option>
                                        <option value="4">4 Meses</option>
                                        <option value="5">5 Meses</option>
                                        <option value="6">6 Meses</option>
                                        <option value="9">9 Meses</option>
                                        <option value="12">12 Meses (1 Año)</option>
                                        <option value="18">18 Meses</option>
                                        <option value="24">24 Meses (2 Años)</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="calc-province" class="block text-gray-600 font-medium mb-2">Provincia</label>
                                    <select id="calc-province" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
                                        <option value="">Seleccione una provincia</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="calc-city" class="block text-gray-600 font-medium mb-2">Ciudad</label>
                                    <select id="calc-city" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" required>
                                        <option value="">Seleccione una provincia primero</option>
                                    </select>
                                </div>
                            </div>
                            <button id="calc-submit" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 mt-6">
                                Calcular Impacto Estimado
                            </button>
                            <div id="calc-result" class="hidden text-center mt-6 p-6 bg-blue-50 border-l-4 border-blue-500 rounded-r-lg">
                                <p class="text-lg text-gray-700">Tu inversión hara que un estimado de:</p>
                                <p id="calc-result-number" class="text-5xl font-extrabold text-blue-600 my-2">0</p>
                                <p id="calc-result-city" class="text-lg text-gray-700">Personas vean tu marca en Córdoba ( por semana )</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECCIÓN 5: TIMELINE (CÓMO FUNCIONA) -->
            <section class="py-20 bg-white">
                <div class="container mx-auto px-6 text-center">
                    <h2 class="text-3xl font-bold text-gray-800 mb-12">Tu Campaña en 3 Pasos Simples</h2>
                    <div class="timeline-container grid md:grid-cols-3 gap-12">
                        <div class="timeline-item">
                            <div class="timeline-dot">1</div>
                            <!-- (Mantenemos z-10 en texto) -->
                            <h3 class="text-xl font-semibold mb-2 relative z-10">Diseña tu Alcance</h3>
                            <p class="text-gray-600 relative z-10">Usa el cotizador para elegir superficie (cm²), zonas de interés y duración. Define tu impacto.</p>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-dot">2</div>
                            <!-- (Mantenemos z-10 en texto) -->
                            <h3 class="text-xl font-semibold mb-2 relative z-10">Producción Rápida</h3>
                            <p class="text-gray-600 relative z-10">Aprobado el diseño, nuestra red de socios gráficos fabrica e instala tu publicidad en tiempo récord.</p>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-dot">3</div>
                            <!-- (Mantenemos z-10 en texto) -->
                            <h3 class="text-xl font-semibold mb-2 relative z-10">Verificación en Vivo</h3>
                            <p class="text-gray-600 relative z-10">Accede a reportes y fotos de los vehículos en la calle. Mide tu impacto y ROI en tiempo real desde tu panel.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Activity Feed -->
            <section class="py-10 bg-gray-900">
                <div class="container mx-auto px-6">
                    <div id="activity-feed" class="h-6 text-center"></div>
                </div>
            </section>

            <!-- SECCIÓN 6: OPORTUNIDADES DUALES -->
            <section class="grid grid-cols-1">

                <!-- Lado A: Conductores -->
                <div id="flota" class="bg-blue-800 text-white py-20">
                    <div class="container mx-auto px-6 grid md:grid-cols-2 gap-12 items-center">
                        <div class="w-full text-center md:text-left md:order-1">
                            <!-- Wrapper for mobile centering -->
                            <!-- [CAMBIO] Redimensionado de 'max-w-md' a 'max-w-sm' para que quepa en móviles angostos -->
                            <div class="max-w-sm mx-auto md:max-w-none md:mx-0">
                                <img src="https://i.postimg.cc/LsTK3hF9/logo-gen-camp.png" alt="Logo Addly" class="h-12 mx-auto mb-6 md:hidden filter brightness-0 invert">
                                <!-- (Mantenemos la reducción de texto anterior) -->
                                <!-- [CAMBIO] Reducción de texto en móvil (de text-sm a text-xs) -->
                                <p class="text-blue-100 text-xs sm:text-lg mb-8">Convierte tu auto, moto o bici en una fuente de ingresos extra. Sin esfuerzo, sin desvíos.</p>

                                <div class="space-y-4 mb-6">
                                    <select id="driver-micro-vehicle" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors text-gray-900" required>
                                        <option value="">¿Qué vehículo tienes?</option>
                                        <option value="AUTO/CAMIONETA">AUTO/CAMIONETA</option>
                                        <option value="MOTO">MOTO</option>
                                        <option value="BICI">BICI</option>
                                    </select>
                                    <input id="driver-micro-email" type="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors text-gray-900" placeholder="Tu correo electrónico" required>
                                </div>

                                <div class="flex flex-col sm:flex-row gap-4">
                                    <button id="show-drivers-cta" class="w-full sm:flex-1 bg-white text-blue-800 font-bold py-4 px-10 rounded-lg text-lg hover:bg-gray-100 transition-colors transform hover:scale-105">
                                        Únete a la Flota
                                    </button>
                                    <button id="save-driver-lead-cta" class="w-full sm:flex-1 bg-green-500 text-white font-bold py-4 px-10 rounded-lg text-lg hover:bg-green-600 transition-colors transform hover:scale-105 hidden">
                                        Enviar
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="md:order-2">
                            <img src="https://i.postimg.cc/L8h4cttk/Secci-n-GRAFICA-CONDUCTOR-20251015-193256-0001.jpg" class="rounded-lg shadow-xl max-w-md mx-auto" alt="Conductor con su auto ploteado">
                        </div>
                    </div>
                </div>

                <!-- Lado B: Gráficas -->
                <div id="graficas" class="bg-gray-50 py-20">
                    <div class="container mx-auto px-6 grid md:grid-cols-2 gap-12 items-center">
                         <div class="w-full text-center md:text-left">
                            <!-- Wrapper for mobile centering -->
                            <div class="max-w-md mx-auto md:max-w-none md:mx-0">
                                <img src="https://i.postimg.cc/LsTK3hF9/logo-gen-camp.png" alt="Logo Addly" class="h-12 mx-auto mb-6 md:hidden">
                                <!-- [CAMBIO] Reducción de texto en móvil (de text-lg a text-base) para evitar rupturas -->
                                <h2 class="text-base sm:text-3xl md:text-4xl font-extrabold text-gray-900 mb-4">SOCIO GRÁFICO: FLUJO DE TRABAJO CONSTANTE</h2>
                                <!-- [CAMBIO] Reducción de texto en móvil (de text-sm a text-xs) -->
                                <p class="text-gray-600 text-xs sm:text-lg mb-8">Asegura un volumen de rotulaciones predecible y rápido. Únete a la red de talleres que crece con Addly.</p>
                                <button id="show-graphs-cta" class="w-full bg-green-500 text-white font-bold py-4 px-10 rounded-lg text-lg hover:bg-green-600 transition-colors transform hover:scale-105">
                                    Registra tu Taller
                                </button>
                            </div>
                        </div>
                        <div class="md:order-2">
                            <!-- [CAMBIO] Redimensionado de 'max-w-md' a 'w-full max-w-sm' para que la imagen se achique en móviles -->
                            <!-- [CAMBIO] Corregida la URL de la imagen. Esta es la de Gráficas, no la de Conductor. -->
                            <img src="https://i.postimg.cc/Z50YG88b/Secci-n-GRAFICA-CONDUCTOR-20251015-193256-0000.jpg" class="rounded-lg shadow-xl w-full max-w-sm mx-auto" alt="Instalador aplicando vinilo">
                        </div>
                    </div>
                </div>

                <!-- [CAMBIO] Eliminada toda la sección de "Gráficas" duplicada que estaba aquí. -->
            </section>

            <!-- SECCIÓN 8: CTA A PÁGINA DE CLIENTES (COTIZADOR) -->
            <section id="cotizador" class="py-20 bg-blue-700 text-white">
                 <div class="container mx-auto px-6 text-center">
                    <h2 class="text-3xl font-bold mb-4">¿Listo para que tu marca llegue lejos?</h2>
                    <p class="max-w-2xl mx-auto mb-8">Descubre el impacto de la publicidad móvil. Obtén una cotización personalizada para tu próxima campaña.</p>
                    <a href="#clientes" class="bg-yellow-400 text-gray-900 font-bold py-3 px-8 rounded-lg text-lg hover:bg-yellow-500 transition-colors">Cotiza tu campaña ahora</a>
                 </div>
            </section>

        </main>

        <footer class="bg-blue-800 text-white">
            <div class="container mx-auto px-6 py-12">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Added text-center md:text-left for mobile centering -->
                    <div class="text-center md:text-left">
                        <h3 class="font-bold mb-4">Enlaces Rápidos</h3>
                        <ul>
                            <li class="mb-2"><a href="#" id="footer-register-driver" class="hover:underline">Conviértete en conductor</a></li>
                             <li><a href="#" id="footer-register-graph" class="hover:underline">Quiero asociar mi grafica</a></li>
                             <li class="mb-2"><a href="#cotizador" class="hover:underline">Cotizar mi Campaña</a></li>
                        </ul>
                    </div>
                    <!-- Added flex flex-col items-center md:items-end for mobile centering -->
                    <div class="flex flex-col items-center md:items-end md:justify-self-end md:col-start-3">
                         <img src="https://i.postimg.cc/LsTK3hF9/logo-gen-camp.png" alt="Logo Addly Blanco" class="h-16 mb-4 filter brightness-0 invert">
                        <div class="flex space-x-4">
                            <a href="https://www.instagram.com/addlyoficial?igsh=M3R5dW1lOWlqZzlo" target="_blank" rel="noopener noreferrer" aria-label="Instagram"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.85s-.011 3.584-.069 4.85c-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07s-3.584-.012-4.85-.07c-3.252-.148-4.771-1.691-4.919-4.919-.058-1.265-.069-1.645-.069-4.85s.011 3.584.069 4.85c.149-3.225 1.664 4.771 4.919 4.919 1.266.058 1.644.07 4.85.07zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948s.014 3.667.072 4.947c.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072s3.667-.014 4.947-.072c4.358-.2 6.78-2.618 6.98-6.98.059-1.281.073-1.689.073-4.948s-.014-3.667-.072-4.947c-.2-4.358-2.618-6.78-6.98-6.98-1.281-.058-1.689-.072-4.948-.072zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.162 6.162 6.162 6.162-2.759 6.162-6.162-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4s1.791-4 4-4 4 1.79 4 4-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.441 1.441 1.441 1.441-.645 1.441-1.441-.645-1.44-1.441-1.44z"/></svg></a>
                            <a href="https://wa.me/message/B4B2BFKSPAUBI1" target="_blank" rel="noopener noreferrer" aria-label="WhatsApp"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12.04 2C6.58 2 2.13 6.45 2.13 11.91C2.13 13.66 2.61 15.35 3.48 16.82L2.1 21.9L7.29 20.53C8.7 21.32 10.33 21.82 12.04 21.82C17.5 21.82 21.95 17.37 21.95 11.91C21.95 6.45 17.5 2 12.04 2ZM12.04 3.63C16.56 3.63 20.32 7.39 20.32 11.91C20.32 16.43 16.56 20.19 12.04 20.19C10.46 20.19 8.96 19.74 7.68 18.91L7.21 18.63L3.83 19.52L4.74 16.23L4.44 15.74C3.63 14.38 3.17 12.87 3.17 11.91C3.17 7.39 6.93 3.63 12.04 3.63ZM9.31 6.51C9.09 6.51 8.76 6.58 8.54 6.91C8.32 7.24 7.51 8.01 7.51 9.28C7.51 10.55 8.56 11.72 8.71 11.92C8.86 12.12 10.15 14.19 12.22 15.02C13.88 15.69 14.39 15.54 14.79 15.49C15.46 15.41 16.42 14.85 16.64 14.24C16.86 13.63 16.86 13.11 16.79 12.98C16.71 12.85 16.54 12.78 16.29 12.65C16.03 12.52 14.89 11.96 14.67 11.88C14.45 11.79 14.28 11.74 14.11 11.99C13.94 12.24 13.43 12.85 13.28 13.02C13.13 13.19 12.98 13.24 12.73 13.11C11.93 12.72 11.08 12.16 10.19 11.2C9.49 10.45 9.02 9.55 8.87 9.28C8.72 9.01 8.84 8.87 8.99 8.74C9.11 8.63 9.28 8.41 9.43 8.24C9.58 8.07 9.63 7.97 9.73 7.79C9.83 7.61 9.78 7.46 9.71 7.33C9.63 7.21 9.31 6.51 9.31 6.51Z"/></svg></a>
                        </div>
                    </div>
                </div>
                 <div class="mt-8 pt-8 border-t border-blue-700 text-center text-sm">
                    <p>&copy; 2025 Gestión de Negocio. Todos los derechos reservados.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- CONTENIDO DE LA APP (Formularios Ocultos) -->
    <div id="app-content" class="hidden">
        <header class="bg-white shadow-md p-4 sticky top-0 z-50">
            <div class="container mx-auto flex justify-between items-center">
                <button id="back-to-home" class="text-gray-600 hover:text-gray-800 transition duration-300">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                    </svg>
                </button>
                <h1 class="text-2xl font-bold text-gray-800">Gestión de Negocio</h1>
                <div class="w-6"></div> </div>
        </header>

        <main class="container mx-auto p-6 flex flex-col items-center justify-center flex-grow">
            <!-- Formulario de Conductores -->
            <section id="drivers-section" class="section-container w-full">
                 <div class="container mx-auto px-6 text-center mb-12">
                    <h2 class="text-3xl font-bold text-gray-800 mb-12">Así de Fácil es Ganar Dinero Conduciendo</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                        <!-- Content -->
                        <div class="text-center">
                            <div class="flex items-center justify-center h-16 w-16 rounded-full bg-blue-600 text-white font-bold text-2xl mx-auto mb-4">01</div>
                            <h3 class="text-xl font-semibold mb-2">Seguridad del Vehículo</h3>
                            <p class="font-semibold text-gray-700 mb-2">¿Es Seguro para mi Auto/Moto/Bici?</p>
                            <p class="text-gray-600">Absolutamente. Utilizamos vinilos y cartelería de alta calidad, seguros para la pintura y el material de tu vehículo...</p>
                        </div>
                         <div class="text-center">
                             <div class="flex items-center justify-center h-16 w-16 rounded-full bg-blue-600 text-white font-bold text-2xl mx-auto mb-4">02</div>
                            <h3 class="text-xl font-semibold mb-2">El Trabajo (Esfuerzo Cero)</h3>
                            <p class="font-semibold text-gray-700 mb-2">¿Qué tengo que hacer?</p>
                            <p class="text-gray-600">Solo Conducir. Usas tu vehículo como siempre...</p>
                        </div>
                         <div class="text-center">
                             <div class="flex items-center justify-center h-16 w-16 rounded-full bg-blue-600 text-white font-bold text-2xl mx-auto mb-4">03</div>
                            <h3 class="text-xl font-semibold mb-2">Las Ganancias</h3>
                             <p class="font-semibold text-gray-700 mb-2">¿Cuánto gano y cómo me pagan?</p>
                            <p class="text-gray-600">Ganancias Mensuales Fijas. Recibirás tu pago completo al finalizar cada mes...</p>
                        </div>
                        <div class="text-center">
                            <div class="flex items-center justify-center h-16 w-16 rounded-full bg-blue-600 text-white font-bold text-2xl mx-auto mb-4">04</div>
                           <h3 class="text-xl font-semibold mb-2">Proceso y Soporte</h3>
                            <p class="font-semibold text-gray-700 mb-2">¿Cuál es el proceso de instalación y retiro?</p>
                           <p class="text-gray-600">Te notificamos la campaña y si aceptas, te enviamos la fecha, hora y dirección...</p>
                       </div>
                    </div>
                </div>
                <img src="https://i.postimg.cc/LsTK3hF9/logo-gen-camp.png" alt="Logo Addly" class="mx-auto mb-6 h-32">
                <h2 class="text-4xl font-semibold text-gray-800 mb-8 text-center">¡Tu Vehículo es Dinero! Regístrate como Socio Chofer</h2>
                <div class="flex flex-wrap justify-center gap-8 max-w-4xl w-full mx-auto">
                    <div id="personal-data-container" class="bg-white p-10 rounded-2xl shadow-xl border border-gray-200 max-w-2xl w-full">
                        <h3 class="text-2xl font-semibold text-gray-700 mb-6 border-b pb-2">1. Tus Datos de Acceso Rápido</h3>
                        <form id="personal-data-form" novalidate>
                           <!-- Form fields ... -->
                            <div class="mb-5">
                                <label for="full-name" class="block text-gray-600 font-medium mb-2">Nombre y Apellido</label>
                                <input type="text" id="full-name" name="full-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="Ej: Juan Pérez" required>
                            </div>
                            <div class="mb-5">
                                <label for="province" class="block text-gray-600 font-medium mb-2">Provincia</label>
                                <select id="province" name="province" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" required>
                                    <option value="">¿Dónde quieres empezar a ganar?</option>
                                    <!-- Options populated by JS -->
                                </select>
                            </div>
                            <div class="mb-5">
                                <label for="personal-city" class="block text-gray-600 font-medium mb-2">Ciudad</label>
                                <select id="personal-city" name="personal-city" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" required>
                                    <option value="">Selecciona tu provincia primero</option>
                                </select>
                            </div>
                            <div class="mb-5">
                                <label for="address-street" class="block text-gray-600 font-medium mb-2">Dirección</label>
                                <div class="flex gap-4">
                                    <input type="text" id="address-street" name="address-street" class="flex-grow px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="Calle" required>
                                    <input type="text" id="address-number" name="address-number" class="w-1/3 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="Número" oninput="this.value = this.value.replace(/[^0-9]/g, '');" required>
                                </div>
                            </div>
                            <div class="mb-5">
                                <label for="phone" class="block text-gray-600 font-medium mb-2">Teléfono</label>
                                <input type="tel" id="phone" name="phone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="Para coordinar tu primera campaña exclusiva" oninput="this.value = this.value.replace(/[^0-9]/g, '');" required>
                            </div>
                            <div class="mb-5">
                                <label for="email" class="block text-gray-600 font-medium mb-2">Correo Electrónico</label>
                                <input type="email" id="email" name="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="Te enviaremos las ofertas de campaña. (Confidencial)" required>
                            </div>
                            <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300">
                                Guardar y Continuar
                            </button>
                        </form>
                    </div>

                    <div id="vehicle-data-container" class="bg-white p-10 rounded-2xl shadow-xl border border-gray-200 hidden max-w-2xl w-full">
                        <div class="relative">
                            <h3 id="vehicle-form-title" class="text-2xl font-semibold text-gray-700 mb-6 border-b pb-2 pr-32">2. Tu Vehículo: El Motor de tus Ganancias</h3>
                             <button id="scroll-to-finish-btn" class="absolute top-[-10px] right-0 bg-green-500 text-white font-bold py-2 px-3 rounded-lg flex items-center gap-2 hover:bg-green-600 transition-colors duration-300 shadow-md transform hover:scale-105 hidden">
                                ¡TERMINÉ!
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                        </div>
                        <div id="driver-id-display" class="hidden bg-gray-100 p-4 rounded-lg text-center mb-4 border border-gray-300">
                            <p class="text-gray-600 font-medium">ID de Conductor:</p>
                            <span id="generated-id" class="text-3xl font-bold text-blue-600"></span>
                        </div>
                        <form id="vehicle-data-form" novalidate>
                            <!-- Form fields ... -->
                             <div class="mb-5">
                                <label for="vehicle-type" class="block text-gray-600 font-medium mb-2">Tipo de Vehículo</label>
                                <select id="vehicle-type" name="vehicle-type" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" required>
                                    <option value="">Auto, Moto, Bici. ¿Cuál genera tus ganancias?</option>
                                    <option value="AUTO/CAMIONETA">AUTO/CAMIONETA</option>
                                    <option value="MOTO">MOTO</option>
                                    <option value="BICI">BICI</option>
                                </select>
                            </div>
                            <div id="backpack-option-container" class="mb-5 hidden">
                                <div class="flex items-center p-4 border border-gray-200 rounded-lg bg-gray-50">
                                    <input id="wants-backpack" name="wants-backpack" type="checkbox" class="h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <label for="wants-backpack" class="ml-3 block text-gray-700 font-medium flex items-center cursor-pointer">
                                        Quiero sumar mi mochila de repartidor
                                        <!-- Tooltip -->
                                        <div class="relative flex items-center ml-2 group">
                                            <span class="bg-black text-white rounded-full h-5 w-5 flex items-center justify-center text-xs font-bold">i</span>
                                            <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-64 p-3 text-sm text-white bg-gray-900 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-10">
                                                Podes agregar publicidad en tu mochila de repartidor si la consideras disponible para hacer publicidad y ganar unos $ de mas !!
                                                <div class="absolute left-1/2 -translate-x-1/2 top-full w-0 h-0 border-x-8 border-x-transparent border-t-8 border-t-gray-900"></div>
                                            </div>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            <div id="brand-container" class="mb-5">
                                <label for="brand" class="block text-gray-600 font-medium mb-2">Marca</label>
                                <input type="text" id="brand" name="brand" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="Ej: Ford, Honda, Scott" required>
                            </div>
                            <div id="model-container" class="mb-5">
                                <label for="model" class="block text-gray-600 font-medium mb-2">Modelo</label>
                                <input type="text" id="model" name="model" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="Ej: Ranger, YBR, Aspect" required>
                            </div>
                            <div class="mb-5">
                                <label for="color" class="block text-gray-600 font-medium mb-2">Color</label>
                                <input type="text" id="color" name="color" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="Para que el vinilo combine perfecto" required>
                            </div>
                            <div id="year-container" class="mb-5">
                                <label for="year" class="block text-gray-600 font-medium mb-2">Año</label>
                                <input type="number" id="year" name="year" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="Ej: 2022" required>
                            </div>
                            <div id="license-plate-container" class="mb-5">
                                <label for="license-plate" class="block text-gray-600 font-medium mb-2">Patente / Matrícula</label>
                                <input type="text" id="license-plate" name="license-plate" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="Ej: AA 123 BC (Información confidencial)" required>
                            </div>
                            <div class="mb-5">
                                <label for="vehicle-province" class="block text-gray-600 font-medium mb-2">Provincia (del vehículo)</label>
                                <select id="vehicle-province" name="vehicle-province" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" required>
                                    <option value="">Seleccione una provincia</option>
                                    <!-- Options populated by JS -->
                                </select>
                            </div>
                            <div class="mb-5">
                                <label for="vehicle-city" class="block text-gray-600 font-medium mb-2">Ciudad (del vehículo)</label>
                                <select id="vehicle-city" name="vehicle-city" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" required>
                                    <option value="">Seleccione una provincia primero</option>
                                </select>
                            </div>
                            <div class="mb-5">
                                <label for="zone-input" class="block text-gray-600 font-medium mb-2">Zona de Circulación Habitual</label>
                                <div class="relative">
                                    <input type="text" id="zone-input" class="w-full px-4 py-3 pr-16 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="Ej: Centro, Nueva Córdoba, Ruta 9. (Máximo impacto)">
                                    <button type="button" id="add-zone-btn" class="absolute inset-y-0 right-0 hidden bg-blue-600 text-white font-semibold py-2 px-4 m-1 rounded-lg shadow-md hover:bg-blue-700 transition duration-300">OK</button>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">Zonas por las que el vehículo circula generalmente, esto nos ayuda a encontrar campañas que se adapten a tus recorridos, mínimo 3.</p>
                                <div id="zone-pills-container" class="mt-3 flex flex-wrap gap-2">
                                </div>
                            </div>
                             <div class="mb-5">
                                <label for="address-street-vehicle" class="block text-gray-600 font-medium mb-2">Dirección de Residencia (del vehículo)</label>
                                <div class="flex gap-4">
                                    <input type="text" id="address-street-vehicle" name="address-street-vehicle" class="flex-grow px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="Calle. Para coordinar la instalación." required>
                                    <input type="text" id="address-number-vehicle" name="address-number-vehicle" class="w-1/3 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="Número" oninput="this.value = this.value.replace(/[^0-9]/g, '');" required>
                                </div>
                            </div>
                             <div class="mb-5">
                                <label for="image" class="block text-gray-600 font-medium mb-2">Foto de tu Vehículo (Opcional)</label>
                                <input type="file" id="image" name="image" accept="image/*" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
                            </div>
                        </form>
                        <div id="added-vehicles-list" class="mt-6 border-t pt-4 border-gray-300">
                            </div>
                        <div class="flex flex-col sm:flex-row gap-4 mt-6">
                            <button id="add-vehicle-btn" class="w-full sm:w-1/2 bg-gray-400 text-gray-800 font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-gray-500 transition duration-300">
                                + Agregar Otro Vehículo y Duplicar Ganancias
                            </button>
                            <button id="finish-vehicles-btn" class="w-full sm:w-1/2 bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300">
                                ¡Listo! Empezar a Recibir Ofertas
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Formulario de Gráficas -->
            <section id="graphs-section" class="section-container w-full">
                <div class="container mx-auto px-6 text-center mb-12">
                    <h2 class="text-3xl font-bold text-gray-800 mb-12">Cómo Crecer con Addly: Beneficios para Socios Gráficos</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                       <!-- Content -->
                        <div class="text-center">
                            <div class="flex items-center justify-center h-16 w-16 rounded-full bg-blue-600 text-white font-bold text-2xl mx-auto mb-4">01</div>
                            <h3 class="text-xl font-semibold mb-2">Garantía de Trabajo</h3>
                            <p class="font-semibold text-gray-700 mb-2">¿Cómo me aseguran un flujo de trabajo constante?</p>
                            <p class="text-gray-600">Addly genera campañas de alto volumen para grandes marcas...</p>
                        </div>
                         <div class="text-center">
                            <div class="flex items-center justify-center h-16 w-16 rounded-full bg-blue-600 text-white font-bold text-2xl mx-auto mb-4">02</div>
                            <h3 class="text-xl font-semibold mb-2">El Proceso (Rapidez y Precio)</h3>
                            <p class="font-semibold text-gray-700 mb-2">¿Cómo funciona el proceso de pedidos?</p>
                            <p class="text-gray-600">Es un sistema rápido: Addly te enviará la solicitud...</p>
                        </div>
                         <div class="text-center">
                            <div class="flex items-center justify-center h-16 w-16 rounded-full bg-blue-600 text-white font-bold text-2xl mx-auto mb-4">03</div>
                            <h3 class="text-xl font-semibold mb-2">Rentabilidad (El Precio Máximo)</h3>
                            <p class="font-semibold text-gray-700 mb-2">¿Cómo garantizo mi ganancia?</p>
                            <p class="text-gray-600">Nuestra plataforma está diseñada para el beneficio mutuo...</p>
                        </div>
                        <div class="text-center">
                            <div class="flex items-center justify-center h-16 w-16 rounded-full bg-blue-600 text-white font-bold text-2xl mx-auto mb-4">04</div>
                            <h3 class="text-xl font-semibold mb-2">Requisito Clave</h3>
                            <p class="font-semibold text-gray-700 mb-2">¿Qué servicios debo cumplir?</p>
                            <p class="text-gray-600">Para ser un socio integral, tu taller debe tener la capacidad...</p>
                        </div>
                    </div>
                </div>
                <img src="https://i.postimg.cc/LsTK3hF9/logo-gen-camp.png" alt="Logo Addly" class="mx-auto mb-6 h-32">
                <h2 class="text-4xl font-semibold text-gray-800 mb-8 text-center">¡Asóciate con Addly! Registro para Gráficas Profesionales</h2>
                <div class="bg-white p-10 rounded-2xl shadow-xl border border-gray-200 max-w-2xl w-full mx-auto">
                    <h3 class="text-2xl font-semibold text-gray-700 mb-6 border-b pb-2">1. Datos de tu Taller (Socio Gráfico)</h3>
                    <form id="graphs-form" novalidate>
                        <!-- Form fields ... -->
                        <div class="mb-5">
                            <label for="graph-name" class="block text-gray-600 font-medium mb-2">Nombre de tu Taller / Marca</label>
                            <input type="text" id="graph-name" name="graph-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="Ej: Rotulaciones Express" required>
                        </div>
                        <div class="mb-5">
                            <label for="manager-name" class="block text-gray-600 font-medium mb-2">Nombre del Contacto Principal</label>
                            <input type="text" id="manager-name" name="manager-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="Ej: Juan Pérez, Encargado de Instalación" required>
                        </div>
                        <div class="mb-5">
                            <label for="graph-phone" class="block text-gray-600 font-medium mb-2">Teléfono de Contacto Rápido</label>
                            <input type="tel" id="graph-phone" name="graph-phone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="Para coordinar instalaciones urgentes" oninput="this.value = this.value.replace(/[^0-9]/g, '');" required>
                        </div>
                        <div class="mb-5">
                            <label for="graph-email" class="block text-gray-600 font-medium mb-2">Correo Electrónico</label>
                            <input type="email" id="graph-email" name="graph-email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="Ej: contacto@taller.com" required>
                        </div>
                         <div class="mb-5">
                            <label for="graphs-province" class="block text-gray-600 font-medium mb-2">Provincia</label>
                            <select id="graphs-province" name="graphs-province" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" required>
                                <option value="">Seleccione una provincia</option>
                                <!-- Options populated by JS -->
                            </select>
                        </div>
                        <div class="mb-5">
                            <label for="graph-location" class="block text-gray-600 font-medium mb-2">Ciudad</label>
                            <select id="graph-location" name="graph-location" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" required>
                                <option value="">Seleccione una provincia primero</option>
                            </select>
                        </div>
                        <div class="mb-5">
                            <label for="graph-address-street" class="block text-gray-600 font-medium mb-2">Dirección del Taller</label>
                            <div class="flex gap-4">
                                <input type="text" id="graph-address-street" name="graph-address-street" class="flex-grow px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="Calle. Dinos dónde te encontramos." required>
                                <input type="text" id="graph-address-number" name="graph-address-number" class="w-1/3 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="Número" oninput="this.value = this.value.replace(/[^0-9]/g, '');" required>
                            </div>
                        </div>
                         <div class="mb-5">
                            <label for="weekly-capacity" class="block text-gray-600 font-medium mb-2">Capacidad de Instalaciones Semanales (Unidades)</label>
                            <input type="number" id="weekly-capacity" name="weekly-capacity" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="Número" required>
                             <p class="text-sm text-gray-600 mt-2">Número máximo de vehículos completos que pueden rotular a la semana...</p>
                        </div>
                        <div class="mb-5">
                            <div class="flex items-center justify-between mb-3">
                                <label class="block text-gray-600 font-medium">Días y Horarios de Atención</label>
                                <div class="flex items-center">
                                    <input type="checkbox" id="apply-all-hours" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <label for="apply-all-hours" class="ml-2 text-sm text-gray-600 cursor-pointer select-none">Aplicar el horario a todos los días</label>
                                </div>
                            </div>
                            <div id="operating-hours-container" class="space-y-3 border border-gray-200 p-4 rounded-lg">
                                <!-- Days/Times populated by JS -->
                                </div>
                             <p class="text-xs text-gray-500 mt-2">Seleccione los días que el taller está abierto e ingrese los horarios de atención.</p>
                        </div>
                        <div class="mb-5">
                             <div class="flex items-center p-4 border border-gray-200 rounded-lg bg-gray-50">
                                <input id="service-commitment" name="service-commitment" type="checkbox" class="h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" required>
                                <label for="service-commitment" class="ml-3 block text-gray-700 font-medium">
                                    Compromiso con el Servicio Integral (Instalación y Retiro)
                                </label>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">Este campo es obligatorio. Al marcarlo, usted acepta y se compromete...</p>
                        </div>
                        <div class="mb-5 border-t border-gray-200 pt-5">
                            <h4 class="text-xl font-semibold text-gray-700">Cotización por Vehículo y Partes</h4>
                            <p class="text-sm text-gray-600 mt-2 mb-4">
                                Ingrese el rango de cotización para cada tipo de instalación...
                            </p>
                            <div class="flex flex-col space-y-4">
                                <!-- Pricing sections ... -->
                                 <div>
                                    <p class="text-lg text-gray-700 p-3 border border-gray-200 rounded-lg bg-gray-100 font-semibold">Auto</p>
                                    <div class="pl-6 mt-2 space-y-3">
                                        <!-- Auto completo -->
                                        <div class="p-3 border-l-4 border-blue-300 bg-gray-50 rounded-r-lg space-y-2">
                                            <div class="flex justify-between items-center text-md text-gray-800 font-medium"><span>Auto completo</span><span class="text-sm text-gray-500 font-normal">(8-12 m²)</span></div>
                                            <div class="flex items-center justify-center gap-2">
                                                <label for="price-from-auto-completo" class="text-sm text-gray-600">DESDE</label><input type="text" id="price-from-auto-completo" name="price-from-auto-completo" class="w-24 px-2 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center" placeholder="$">
                                                <span class="text-gray-600 font-bold">-</span>
                                                <label for="price-to-auto-completo" class="text-sm text-gray-600">HASTA</label><input type="text" id="price-to-auto-completo" name="price-to-auto-completo" class="w-24 px-2 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center" placeholder="$">
                                            </div>
                                            <div><input type="text" name="vinyl-auto-completo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors placeholder:text-center" placeholder="Tipo de vinilo"></div>
                                            <div class="flex justify-center items-center gap-2"><input type="text" name="installation-time-auto-completo" class="w-24 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors text-center" placeholder="Ej: 8" oninput="this.value = this.value.replace(/[^0-9.,]/g, '');"><span class="text-gray-600">horas</span></div>
                                        </div>
                                        <!-- Capot -->
                                        <div class="p-3 border-l-4 border-blue-300 bg-gray-50 rounded-r-lg space-y-2">
                                            <div class="flex justify-between items-center text-md text-gray-800 font-medium"><span>Capot</span><span class="text-sm text-gray-500 font-normal">(18,000-23,000 cm²)</span></div>
                                            <div class="flex items-center justify-center gap-2">
                                                <label for="price-from-capot" class="text-sm text-gray-600">DESDE</label><input type="text" id="price-from-capot" name="price-from-capot" class="w-24 px-2 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center" placeholder="$">
                                                <span class="text-gray-600 font-bold">-</span>
                                                <label for="price-to-capot" class="text-sm text-gray-600">HASTA</label><input type="text" id="price-to-capot" name="price-to-capot" class="w-24 px-2 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center" placeholder="$">
                                            </div>
                                            <div><input type="text" name="vinyl-capot" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors placeholder:text-center" placeholder="Tipo de vinilo"></div>
                                             <div class="flex justify-center items-center gap-2"><input type="text" name="installation-time-capot" class="w-24 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors text-center" placeholder="Ej: 2" oninput="this.value = this.value.replace(/[^0-9.,]/g, '');"><span class="text-gray-600">horas</span></div>
                                        </div>
                                        <!-- Puertas -->
                                        <div class="p-3 border-l-4 border-blue-300 bg-gray-50 rounded-r-lg space-y-2">
                                             <div class="flex justify-between items-center text-md text-gray-800 font-medium"><span>Puertas</span><span class="text-sm text-gray-500 font-normal">(10,000-14,000 cm² c/u)</span></div>
                                             <div class="flex items-center justify-center gap-2">
                                                <label for="price-from-puertas" class="text-sm text-gray-600">DESDE</label><input type="text" id="price-from-puertas" name="price-from-puertas" class="w-24 px-2 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center" placeholder="$">
                                                <span class="text-gray-600 font-bold">-</span>
                                                <label for="price-to-puertas" class="text-sm text-gray-600">HASTA</label><input type="text" id="price-to-puertas" name="price-to-puertas" class="w-24 px-2 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center" placeholder="$">
                                            </div>
                                             <div><input type="text" name="vinyl-puertas" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors placeholder:text-center" placeholder="Tipo de vinilo"></div>
                                             <div class="flex justify-center items-center gap-2"><input type="text" name="installation-time-puertas" class="w-24 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors text-center" placeholder="Ej: 1.5" oninput="this.value = this.value.replace(/[^0-9.,]/g, '');"><span class="text-gray-600">horas</span></div>
                                        </div>
                                        <!-- Baul -->
                                        <div class="p-3 border-l-4 border-blue-300 bg-gray-50 rounded-r-lg space-y-2">
                                             <div class="flex justify-between items-center text-md text-gray-800 font-medium"><span>Baul</span><span class="text-sm text-gray-500 font-normal">(5,000-7,000 cm²)</span></div>
                                             <div class="flex items-center justify-center gap-2">
                                                <label for="price-from-baul" class="text-sm text-gray-600">DESDE</label><input type="text" id="price-from-baul" name="price-from-baul" class="w-24 px-2 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center" placeholder="$">
                                                <span class="text-gray-600 font-bold">-</span>
                                                <label for="price-to-baul" class="text-sm text-gray-600">HASTA</label><input type="text" id="price-to-baul" name="price-to-baul" class="w-24 px-2 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center" placeholder="$">
                                            </div>
                                             <div><input type="text" name="vinyl-baul" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors placeholder:text-center" placeholder="Tipo de vinilo"></div>
                                             <div class="flex justify-center items-center gap-2"><input type="text" name="installation-time-baul" class="w-24 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors text-center" placeholder="Ej: 1" oninput="this.value = this.value.replace(/[^0-9.,]/g, '');"><span class="text-gray-600">horas</span></div>
                                        </div>
                                        <!-- Luneta -->
                                        <div class="p-3 border-l-4 border-blue-300 bg-gray-50 rounded-r-lg space-y-2">
                                             <div class="flex justify-between items-center text-md text-gray-800 font-medium"><span>Luneta</span><span class="text-sm text-gray-500 font-normal">(6,500-12,000 cm²)</span></div>
                                             <div class="flex items-center justify-center gap-2">
                                                <label for="price-from-luneta" class="text-sm text-gray-600">DESDE</label><input type="text" id="price-from-luneta" name="price-from-luneta" class="w-24 px-2 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center" placeholder="$">
                                                <span class="text-gray-600 font-bold">-</span>
                                                <label for="price-to-luneta" class="text-sm text-gray-600">HASTA</label><input type="text" id="price-to-luneta" name="price-to-luneta" class="w-24 px-2 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center" placeholder="$">
                                            </div>
                                             <div><input type="text" name="vinyl-luneta" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors placeholder:text-center" placeholder="Tipo de vinilo"></div>
                                             <div class="flex justify-center items-center gap-2"><input type="text" name="installation-time-luneta" class="w-24 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors text-center" placeholder="Ej: 1" oninput="this.value = this.value.replace(/[^0-9.,]/g, '');"><span class="text-gray-600">horas</span></div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Moto -->
                                <div>
                                     <div class="flex justify-between items-center text-lg text-gray-700 p-3 border border-gray-200 rounded-lg bg-gray-100 font-semibold"><span>Moto</span><span class="text-sm text-gray-500 font-normal">(5,000-15,000 cm²)</span></div>
                                     <div class="mt-2 px-3 pb-2 space-y-3">
                                        <div class="flex items-center justify-center gap-2">
                                            <label for="price-from-moto" class="text-sm text-gray-600">DESDE</label><input type="text" id="price-from-moto" name="price-from-moto" class="w-24 px-2 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center" placeholder="$">
                                            <span class="text-gray-600 font-bold">-</span>
                                            <label for="price-to-moto" class="text-sm text-gray-600">HASTA</label><input type="text" id="price-to-moto" name="price-to-moto" class="w-24 px-2 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center" placeholder="$">
                                        </div>
                                         <div><input type="text" name="vinyl-moto" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors placeholder:text-center" placeholder="Tipo de vinilo"></div>
                                         <div class="flex justify-center items-center gap-2"><input type="text" name="installation-time-moto" class="w-24 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors text-center" placeholder="Ej: 3" oninput="this.value = this.value.replace(/[^0-9.,]/g, '');"><span class="text-gray-600">horas</span></div>
                                    </div>
                                </div>
                                <!-- Bici -->
                                <div>
                                     <p class="text-lg text-gray-700 p-3 border border-gray-200 rounded-lg bg-gray-100 font-semibold">Bici</p>
                                     <div class="mt-2 px-3 pb-2 space-y-3">
                                        <div class="flex items-center justify-center gap-2">
                                            <label for="price-from-bici" class="text-sm text-gray-600">DESDE</label><input type="text" id="price-from-bici" name="price-from-bici" class="w-24 px-2 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center" placeholder="$">
                                            <span class="text-gray-600 font-bold">-</span>
                                            <label for="price-to-bici" class="text-sm text-gray-600">HASTA</label><input type="text" id="price-to-bici" name="price-to-bici" class="w-24 px-2 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center" placeholder="$">
                                        </div>
                                         <div><input type="text" name="vinyl-bici" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors placeholder:text-center" placeholder="Tipo de vinilo"></div>
                                         <div class="flex justify-center items-center gap-2"><input type="text" name="installation-time-bici" class="w-24 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors text-center" placeholder="Ej: 1" oninput="this.value = this.value.replace(/[^0-9.,]/g, '');"><span class="text-gray-600">horas</span></div>
                                    </div>
                                </div>
                                <!-- Mochila -->
                                <div>
                                     <div class="flex justify-between items-center text-lg text-gray-700 p-3 border border-gray-200 rounded-lg bg-gray-100 font-semibold"><span>Mochila de repartidor</span><span class="text-sm text-gray-500 font-normal">(15 x 33 cm)</span></div>
                                     <div class="mt-2 px-3 pb-2 space-y-3">
                                        <div class="flex items-center justify-center gap-2">
                                            <label for="price-from-mochila" class="text-sm text-gray-600">DESDE</label><input type="text" id="price-from-mochila" name="price-from-mochila" class="w-24 px-2 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center" placeholder="$">
                                            <span class="text-gray-600 font-bold">-</span>
                                            <label for="price-to-mochila" class="text-sm text-gray-600">HASTA</label><input type="text" id="price-to-mochila" name="price-to-mochila" class="w-24 px-2 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center" placeholder="$">
                                        </div>
                                         <div><input type="text" name="vinyl-mochila" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors placeholder:text-center" placeholder="Tipo de vinilo"></div>
                                         <div class="flex justify-center items-center gap-2"><input type="text" name="installation-time-mochila" class="w-24 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors text-center" placeholder="Ej: 0.5" oninput="this.value = this.value.replace(/[^0-9.,]/g, '');"><span class="text-gray-600">horas</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300">
                            Guardar Datos de la Gráfica
                        </button>
                    </form>
                    <div id="graph-id-display" class="hidden bg-gray-100 p-4 rounded-lg text-center mt-6 border border-gray-300">
                        <p class="text-gray-600 font-medium">ID de Gráfica:</p>
                        <span id="generated-graph-id" class="text-3xl font-bold text-blue-600"></span>
                    </div>
                </div>
            </section>

            </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js"></script>
    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, runTransaction, collection, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"; // Added serverTimestamp

        // --- Pop-up Modal Elements ---
        const modalOverlay = document.getElementById('success-modal-overlay');
        const modalBox = document.getElementById('success-modal-box');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const modalCloseBtn = document.getElementById('modal-close-btn');

        //  CTA Flotantes
        const floatingCtaMobile = document.getElementById('floating-cta-mobile');
        const floatingCtaDesktop = document.getElementById('floating-cta-desktop');

        // --- Helper Functions ---
        // (showSuccessModal, hideSuccessModal, handleModalClose, showMessage)
         const showSuccessModal = (title, message, redirectOnClose = false) => {
            if (modalTitle) modalTitle.textContent = title;
            if (modalMessage) modalMessage.textContent = message;
            if (modalOverlay) {
                modalOverlay.dataset.redirectOnClose = redirectOnClose;
                modalOverlay.classList.remove('hidden');
                setTimeout(() => {
                    modalOverlay.classList.remove('opacity-0');
                    if (modalBox) modalBox.classList.remove('opacity-0', 'scale-95');
                }, 10);
            }
        };

        const hideSuccessModal = () => {
             if (modalOverlay) modalOverlay.classList.add('opacity-0');
            if (modalBox) modalBox.classList.add('opacity-0', 'scale-95');
            setTimeout(() => {
                if (modalOverlay) modalOverlay.classList.add('hidden');
            }, 300);
        };

        const handleModalClose = () => {
            // Check if redirect target is specifically 'drivers' for pre-fill
            const shouldRedirect = modalOverlay?.dataset.redirectOnClose === 'true';
            const redirectTarget = modalOverlay?.dataset.redirectTarget;
            const prefillData = modalOverlay?.dataset.prefill ? JSON.parse(modalOverlay.dataset.prefill) : null;

            hideSuccessModal();

             // [NUEVO] Reset micro-form fields after modal closes if it came from micro-form
             if (redirectTarget === 'drivers') {
                 const driverMicroVehicle = document.getElementById('driver-micro-vehicle');
                 const driverMicroEmail = document.getElementById('driver-micro-email');
                 if(driverMicroVehicle) driverMicroVehicle.value = '';
                 if(driverMicroEmail) driverMicroEmail.value = '';
                 // Ensure the correct button is shown after reset
                 const showDriversCta = document.getElementById('show-drivers-cta');
                 const saveDriverLeadCta = document.getElementById('save-driver-lead-cta');
                 if(showDriversCta) showDriversCta.classList.remove('hidden');
                 if(saveDriverLeadCta) saveDriverLeadCta.classList.add('hidden');
             }

            if (shouldRedirect) {
                setTimeout(() => {
                    if (redirectTarget === 'drivers') {
                        switchSection('drivers');
                        // Pre-fill logic moved here
                        if(prefillData) {
                            const mainFormVehicleType = document.getElementById('vehicle-type');
                            const mainFormEmail = document.getElementById('email');
                            if(mainFormVehicleType) mainFormVehicleType.value = prefillData.vehicleType || '';
                            if(mainFormEmail) mainFormEmail.value = prefillData.email || '';
                        }
                    } else {
                        // Default redirect if no specific target or target is not 'drivers'
                         returnToInitialView();
                    }
                    // Clean up modal data attributes
                    if (modalOverlay) {
                        delete modalOverlay.dataset.redirectOnClose;
                        delete modalOverlay.dataset.redirectTarget;
                        delete modalOverlay.dataset.prefill;
                    }
                }, 300);
            }
        }


        if (modalCloseBtn) modalCloseBtn.addEventListener('click', handleModalClose);
        if (modalOverlay) modalOverlay.addEventListener('click', (e) => { if (e.target === modalOverlay) handleModalClose(); });

        const showMessage = (message, isSuccess) => {
            const messageBox = document.createElement('div');
            messageBox.textContent = message;
            const bgColor = isSuccess ? 'bg-green-500' : 'bg-red-500';
            messageBox.className = `fixed bottom-5 right-5 p-4 rounded-lg shadow-lg text-white font-medium transition-transform transform z-50 ${bgColor}`;
            document.body.appendChild(messageBox);
            setTimeout(() => {
                messageBox.style.transform = 'translateY(200%)';
                messageBox.addEventListener('transitionend', () => messageBox.remove());
            }, 5000);
        };

        // --- [CAMBIO] Custom Smooth Scroll Function (Agregada para scroll lento) ---
        function customSmoothScroll(targetPosition, duration) {
            const startPosition = window.pageYOffset;
            const distance = targetPosition - startPosition;
            let startTime = null;

            // Easing function (ease-in-out quad)
            // t = currentTime, b = startValue, c = changeInValue, d = duration
            const easeInOutQuad = (t, b, c, d) => {
                t /= d / 2;
                if (t < 1) return c / 2 * t * t + b;
                t--;
                return -c / 2 * (t * (t - 2) - 1) + b;
            };

            function animationLoop(currentTime) {
                if (startTime === null) startTime = currentTime;
                const timeElapsed = currentTime - startTime;
                const nextScrollPosition = easeInOutQuad(timeElapsed, startPosition, distance, duration);

                window.scrollTo(0, nextScrollPosition);

                if (timeElapsed < duration) {
                    requestAnimationFrame(animationLoop);
                } else {
                    window.scrollTo(0, targetPosition); // Asegura que termine exactamente en el destino
                }
            }

            requestAnimationFrame(animationLoop);
        }


        // --- Firebase Setup ---
        const firebaseConfig = { /* ... firebase config ... */
          apiKey: "AIzaSyDZkQgLJd_pqk98MEZoMlo-6SFYxJqtbnU",
          authDomain: "gestor-addly.firebaseapp.com",
          projectId: "gestor-addly",
          storageBucket: "gestor-addly.firebasestorage.app",
          messagingSenderId: "1072574102423",
          appId: "1:1072574102423:web:958ccd03f7c327a9c862d2",
          measurementId: "G-1M90X7WGEN"
        };

        let app, db, auth;
        let currentDriverData = null;
        let currentZones = [];

        // --- Navigation Logic ---
        const initialView = document.getElementById('initial-view');
        const appContent = document.getElementById('app-content');
        const driversSection = document.getElementById('drivers-section');
        const graphsSection = document.getElementById('graphs-section');
        const sections = { 'drivers': driversSection, 'graphs': graphsSection };

        function switchSection(sectionId) {
            Object.values(sections).forEach(section => { if(section) section.classList.remove('active'); });
            const activeSection = sections[sectionId];
            if (activeSection) {
                activeSection.classList.add('active');
                if(initialView) initialView.classList.add('hidden'); // Use classList for consistency
                if(appContent) appContent.classList.remove('hidden');
                window.scrollTo(0, 0);
                if (floatingCtaMobile) floatingCtaMobile.style.display = 'none';
                if (floatingCtaDesktop) floatingCtaDesktop.style.display = 'none';
            } else { console.error(`Section ID '${sectionId}' not found.`); }
        }

        function returnToInitialView() {
            if(initialView) initialView.classList.remove('hidden');
            if(appContent) appContent.classList.add('hidden');
            window.scrollTo(0, 0);
            if (floatingCtaMobile) floatingCtaMobile.style.display = ''; // Use empty string to reset display
            if (floatingCtaDesktop) floatingCtaDesktop.style.display = '';
        }

        // --- Utility Function: Populate Select ---
        function populateSelect(selectElement, items, placeholder) {
            if (!selectElement) return;
            selectElement.innerHTML = `<option value="">${placeholder}</option>`;
            items.forEach(item => {
                const option = document.createElement('option');
                option.value = item;
                option.textContent = item;
                selectElement.appendChild(option);
            });
        }

        // --- City/Province Data & Logic ---
        const provincesAndCities = { /* ... data ... */
            "Buenos Aires": ["La Plata (Capital)", "Mar del Plata", "Bahía Blanca", "San Nicolás de los Arroyos", "General Pueyrredón", "Moreno", "Quilmes", "Vicente López", "Tigre", "Lomas de Zamora", "La Matanza", "Pilar", "Berisso", "San Fernando"],
            "Catamarca": ["San Fernando del Valle de Catamarca (Capital)", "Valle Viejo", "Tinogasta", "Santa María", "Andalgalá", "Belén", "Recreo"],
            "Chaco": ["Resistencia (Capital)", "Barranqueras", "Charata", "Castelli", "Sáenz Peña", "Villa Ángela", "Las Palmas"],
            "Chubut": ["Rawson (Capital)", "Comodoro Rivadavia", "Puerto Madryn", "Trelew", "Esquel", "Sarmiento", "Rada Tilly"],
            "Córdoba": ["Córdoba (Capital)", "Villa Carlos Paz", "Río Cuarto", "Villa María", "Jesús María", "Alta Gracia", "San Francisco"],
            "Corrientes": ["Corrientes (Capital)", "Goya", "Santo Tomé", "Curuzú Cuatiá", "Paso de los Libres", "Mercedes", "Bella Vista"],
            "Entre Ríos": ["Paraná (Capital)", "Concordia", "Gualeguaychú", "Concepción del Uruguay", "Federación", "Victoria", "Villaguay"],
            "Formosa": ["Formosa (Capital)", "Clorinda", "Las Lomitas", "Ingeniero Juárez"],
            "Jujuy": ["San Salvador de Jujuy (Capital)", "San Pedro de Jujuy", "Libertador General San Martín", "Perico", "Palpalá"],
            "La Pampa": ["Santa Rosa (Capital)", "General Pico", "Eduardo Castex", "Realicó", "Toay"],
            "La Rioja": ["La Rioja (Capital)", "Chilecito", "Aimogasta", "Chepes"],
            "Mendoza": ["Mendoza (Capital)", "San Rafael", "Godoy Cruz", "Maipú", "Las Heras", "Guaymallén", "Luján de Cuyo"],
            "Misiones": ["Posadas (Capital)", "Eldorado", "Oberá", "Puerto Iguazú", "San Vicente"],
            "Neuquén": ["Neuquén (Capital)", "Plottier", "Cutral Có", "Centenario", "San Martín de los Andes"],
            "Río Negro": ["Viedma (Capital)", "General Roca", "San Carlos de Barilochem", "Cipolletti", "Villa Regina", "El Bolsón"],
            "Salta": ["Salta (Capital)", "San Ramón de la Nueva Orán", "Tartagal", "Metán", "Cafayate", "Rosario de la Frontera"],
            "San Juan": ["San Juan (Capital)", "Caucete", "Rivadavia", "Chimbas", "San José de Jáchal"],
            "San Luis": ["San Luis (Capital)", "Villa Mercedes", "Merlo", "La Punta", "Juana Koslay"],
            "Santa Cruz": ["Río Gallegos (Capital)", "Caleta Olivia", "Pico Truncado", "Puerto Deseado", "El Calafate"],
            "Santa Fe": ["Santa Fe (Capital)", "Rosario", "Venado Tuerto", "Rafaela", "Reconquista", "Santo Tomé"],
            "Santiago del Estero": ["Santiago del Estero (Capital)", "La Banda", "Termas de Río Hondo", "Añatuya", "Frías"],
            "Tierra del Fuego, Antártida e Islas del Atlántico Sur": ["Ushuaia (Capital)", "Río Grande", "Tolhuin"],
            "Tucumán": ["San Miguel de Tucumán (Capital)", "Yerba Buena", "Concepción", "Tafí Viejo", "Banda del Río Salí"]
        };
        // --- ID Generation Data ---
        const provinceCodes = {
            "Buenos Aires": "PBA", "Catamarca": "CT", "Chaco": "CH", "Chubut": "CHB", "Córdoba": "CD",
            "Corrientes": "CR", "Entre Ríos": "ER", "Formosa": "FM", "Jujuy": "JJ", "La Pampa": "LP",
            "La Rioja": "LR", "Mendoza": "MZ", "Misiones": "MN", "Neuquén": "NQ", "Río Negro": "RN",
            "Salta": "ST", "San Juan": "SJ", "San Luis": "SL", "Santa Cruz": "SC", "Santa Fe": "SF",
            "Santiago del Estero": "SE", "Tierra del Fuego, Antártida e Islas del Atlántico Sur": "TF", "Tucumán": "TC"
        };
        const cityAbbreviations = {
            "La Plata (Capital)": "LPT", "Mar del Plata": "MDP", "Bahía Blanca": "BHI", "San Nicolás de los Arroyos": "SNA",
            "General Pueyrredón": "GPY", "Moreno": "MRE", "Quilmes": "QLM", "Vicente López": "VLO", "Tigre": "TGR",
            "Lomas de Zamora": "LZA", "La Matanza": "LMT", "Pilar": "PLR", "Berisso": "BSS", "San Fernando": "SFD",
            "San Fernando del Valle de Catamarca (Capital)": "SFC", "Valle Viejo": "VVI", "Tinogasta": "TIN", "Santa María": "SMA",
            "Andalgalá": "AND", "Belén": "BLN", "Recreo": "RCR", "Resistencia (Capital)": "RES", "Barranqueras": "BQS",
            "Charata": "CHT", "Castelli": "CAS", "Sáenz Peña": "SPE", "Villa Ángela": "VAN", "Las Palmas": "LPA",
            "Rawson (Capital)": "RWS", "Comodoro Rivadavia": "CRV", "Puerto Madryn": "PMY", "Trelew": "TRW", "Esquel": "EQS",
            "Sarmiento": "SAR", "Rada Tilly": "RTY", "Córdoba (Capital)": "CBA", "Villa Carlos Paz": "VCP", "Río Cuarto": "RCO",
            "Villa María": "VMA", "Jesús María": "JMA", "Alta Gracia": "AGR", "San Francisco": "SFO", "Corrientes (Capital)": "CRR",
            "Goya": "GOY", "Santo Tomé": "STE", "Curuzú Cuatiá": "CCU", "Paso de los Libres": "PLL", "Mercedes": "MCE",
            "Bella Vista": "BVS", "Paraná (Capital)": "PRA", "Concordia": "CON", "Gualeguaychú": "GUY", "Concepción del Uruguay": "CDU",
            "Federación": "FDR", "Victoria": "VTO", "Villaguay": "VGY", "Formosa (Capital)": "FMA", "Clorinda": "CLO",
            "Las Lomitas": "LLM", "Ingeniero Juárez": "IJU", "San Salvador de Jujuy (Capital)": "SSJ", "San Pedro de Jujuy": "SPJ",
            "Libertador General San Martín": "LGS", "Perico": "PRC", "Palpalá": "PPA", "Santa Rosa (Capital)": "RSA", "General Pico": "GPI",
            "Eduardo Castex": "ECX", "Realicó": "RLC", "Toay": "TOY", "La Rioja (Capital)": "IRJ", "Chilecito": "CHT",
            "Aimogasta": "AMG", "Chepes": "CPE", "Mendoza (Capital)": "MDZ", "San Rafael": "SRA", "Godoy Cruz": "GCR",
            "Maipú": "MPI", "Las Heras": "LHR", "Guaymallén": "GYM", "Luján de Cuyo": "LCN", "Posadas (Capital)": "POS",
            "Eldorado": "ELD", "Oberá": "OBR", "Puerto Iguazú": "IGR", "San Vicente": "SVT", "Neuquén (Capital)": "NQN",
            "Plottier": "PLT", "Cutral Có": "CCO", "Centenario": "CEN", "San Martín de los Andes": "SMA", "Viedma (Capital)": "VDM",
            "General Roca": "GRC", "San Carlos de Barilochem": "BRC", "Cipolletti": "CPL", "Villa Regina": "VRE", "El Bolsón": "EBO",
            "Salta (Capital)": "SLA", "San Ramón de la Nueva Orán": "SRO", "Tartagal": "TAR", "Metán": "MTN", "Cafayate": "CFY",
            "Rosario de la Frontera": "RFR", "San Juan (Capital)": "SJN", "Caucete": "CAU", "Rivadavia": "RVA", "Chimbas": "CHB",
            "San José de Jáchal": "SJH", "San Luis (Capital)": "SLS", "Villa Mercedes": "VME", "Merlo": "MRL", "La Punta": "LPT",
            "Juana Koslay": "JKO", "Río Gallegos (Capital)": "RGL", "Caleta Olivia": "CLV", "Pico Truncado": "PTR",
            "Puerto Deseado": "PDS", "El Calafate":"ECA", "Santa Fe (Capital)": "SFN", "Rosario": "ROS", "Venado Tuerto": "VTU",
            "Rafaela": "RAF", "Reconquista": "RTA", "Santo Tomé": "STF", "Santiago del Estero (Capital)": "SDE",
            "La Banda": "LBD", "Termas de Río Hondo": "TRH", "Añatuya": "ANT", "Frías": "FRI", "Ushuaia (Capital)": "USH",
            "Río Grande": "RGA", "Tolhuin": "TLH", "San Miguel de Tucumán (Capital)": "TUC", "Yerba Buena": "YBU", "Concepción": "CCN",
            "Tafí Viejo": "TFV", "Banda del Río Salí": "BRS"
        };
        const getProvinceCode = (provinceName) => provinceCodes[provinceName] || 'XX';
        const getCityAbbreviation = (cityName) => cityAbbreviations[cityName] || 'XXX';

        // --- ID Generation Function ---
        const getNextId = async (category, code) => {
            if (!db) return null;
            const countersRef = doc(db, 'metadata_gestion_negocios', 'counters');
             // [MODIFICADO] Use 'LEAD' category directly if requested
             const fieldKey = (category === 'LEAD') ? 'LEAD' : `${category}_${code}`;
            try {
                const newCount = await runTransaction(db, async (transaction) => {
                    const countersDoc = await transaction.get(countersRef);
                    let nextCount = 1;
                    if (countersDoc.exists()) {
                        const currentCount = countersDoc.data()[fieldKey] || 0;
                        nextCount = currentCount + 1;
                        transaction.update(countersRef, { [fieldKey]: nextCount });
                    } else {
                        transaction.set(countersRef, { [fieldKey]: nextCount });
                    }
                    return nextCount;
                });
                return newCount;
            } catch (e) { console.error("Transaction failed: ", e); throw new Error("No se pudo generar el ID."); }
        };

        function setupProvinceCitySelects(provinceSelectId, citySelectId) {
            const provinceSelect = document.getElementById(provinceSelectId);
            const citySelect = document.getElementById(citySelectId);
            if (!provinceSelect || !citySelect) { console.error(`Selects not found: ${provinceSelectId}, ${citySelectId}`); return; }
            const provinces = Object.keys(provincesAndCities);
            populateSelect(provinceSelect, provinces, "Seleccione una provincia");
            provinceSelect.addEventListener('change', () => {
                const selectedProvince = provinceSelect.value;
                if (selectedProvince && provincesAndCities[selectedProvince]) {
                    populateSelect(citySelect, provincesAndCities[selectedProvince], "Seleccione una ciudad");
                } else { citySelect.innerHTML = '<option value="">Seleccione una provincia primero</option>'; }
            });
        }

        // --- Form Validation Helper ---
        const validateForm = (formElement, constraints = {}) => {
             if (!formElement) return false;
             let isValid = true;
             let firstInvalidField = null; // [MANTIENE]
             const fields = formElement.querySelectorAll('input[required]:not([type="file"]), select[required], textarea[required]'); // Exclude file input from basic check
             
             fields.forEach(field => {
                 // [MODIFICADO] Lógica de visibilidad mucho más robusta.
                 // Comprueba si el campo o CUALQUIER padre hasta el formulario está oculto.
                 let isVisible = true;
                 let currentElement = field;
                 while (currentElement && currentElement !== formElement) {
                     if (currentElement.classList.contains('hidden')) {
                         isVisible = false;
                         break;
                     }
                     currentElement = currentElement.parentElement;
                 }
                 
                 if (!isVisible) {
                     field.classList.remove('invalid-field'); // Limpiar por si acaso
                     return; // Saltar validación
                 }
                 // --- Fin de la modificación de visibilidad ---

                 let fieldValid = (field.type === 'checkbox') ? field.checked : field.value.trim() !== '';
                 if (fieldValid && constraints[field.id]) fieldValid = constraints[field.id](field.value);

                 if (!fieldValid) {
                     isValid = false;
                     field.classList.add('invalid-field');
                     if (!firstInvalidField) { // [NUEVO]
                         firstInvalidField = field;
                     }
                 } else {
                     field.classList.remove('invalid-field');
                 }
             });

              // [MODIFICADO] Se movió la validación de zonas DENTRO de esta función
             if (formElement.id === 'vehicle-data-form') {
                if (zoneInput && currentZones.length < 3) {
                     isValid = false;
                     zoneInput.classList.add('invalid-field');
                     if (!firstInvalidField) { // [NUEVO]
                         firstInvalidField = zoneInput;
                     }
                 } else if (zoneInput) {
                    zoneInput.classList.remove('invalid-field');
                 }
             }

             // [NUEVO] Scroll y focus al primer campo inválido
             if (firstInvalidField) {
                 firstInvalidField.focus();
                 firstInvalidField.scrollIntoView({ behavior: 'smooth', block: 'center' });
             }

             return isValid;
        };

        // --- DOM Elements (Ensure critical ones exist) ---
        const backToHomeBtn = document.getElementById('back-to-home');
        const generatedIdElement = document.getElementById('generated-id');
        const driverIdDisplay = document.getElementById('driver-id-display');
        const generatedGraphIdElement = document.getElementById('generated-graph-id');
        const graphIdDisplay = document.getElementById('graph-id-display');
        const personalDataContainer = document.getElementById('personal-data-container');
        const vehicleDataContainer = document.getElementById('vehicle-data-container');
        const vehicleFormTitle = document.getElementById('vehicle-form-title');
        const addVehicleBtn = document.getElementById('add-vehicle-btn');
        const finishVehiclesBtn = document.getElementById('finish-vehicles-btn');
        const scrollToFinishBtn = document.getElementById('scroll-to-finish-btn');
        const addedVehiclesList = document.getElementById('added-vehicles-list');
        const zoneInput = document.getElementById('zone-input');
        const addZoneBtn = document.getElementById('add-zone-btn');
        const zonePillsContainer = document.getElementById('zone-pills-container');
        const vehicleTypeSelect = document.getElementById('vehicle-type');
        const backpackOptionContainer = document.getElementById('backpack-option-container');
        const brandContainer = document.getElementById('brand-container');
        const modelContainer = document.getElementById('model-container');
        const yearContainer = document.getElementById('year-container');
        const licensePlateContainer = document.getElementById('license-plate-container');
        const brandInput = document.getElementById('brand');
        const modelInput = document.getElementById('model');
        const yearInput = document.getElementById('year');
        const licensePlateInput = document.getElementById('license-plate');
        const driverEmailInput = document.getElementById('email');
        const graphEmailInput = document.getElementById('graph-email');

        // --- Driver Form Helpers ---
        // (saveVehicleData, resetVehicleForm, resetDriverForm, updateAddedVehiclesList)
        function saveVehicleData() {
            const vehicleDataForm = document.getElementById('vehicle-data-form');
            if (!vehicleDataForm) return false;
            const constraints = { 'year': (v) => v.length === 4 && parseInt(v) > 1980 && parseInt(v) <= new Date().getFullYear() + 1 };
            
            // [MODIFICADO] Esta función 'validateForm' AHORA incluye la validación de zonas.
            if (!validateForm(vehicleDataForm, constraints)) {
                 showMessage('Por favor complete todos los campos obligatorios del vehículo.', false);
                 return false;
            }
             
             // [ELIMINADO] El chequeo de 'currentZones.length < 3' es ahora REDUNDANTE.
             // 'validateForm' ya lo maneja y hace focus en el campo de zonas si falla.
             /* if (currentZones.length < 3) {
                 showMessage('Debe agregar al menos 3 zonas de circulación habitual.', false);
                 if (zoneInput) zoneInput.classList.add('invalid-field');
                 return false;
             }
             */

            if (!currentDriverData) { console.error("No currentDriverData."); return false; }
            if (!currentDriverData.vehicles) currentDriverData.vehicles = [];

            const colorEl = document.getElementById('color');
            const vpEl = document.getElementById('vehicle-province');
            const vcEl = document.getElementById('vehicle-city');
            const asvEl = document.getElementById('address-street-vehicle');
            const anvEl = document.getElementById('address-number-vehicle');
            const wbEl = document.getElementById('wants-backpack');
            const imageEl = document.getElementById('image'); // Get image input

             const vehicleData = {
                type: vehicleTypeSelect?.value,
                color: colorEl?.value,
                province: vpEl?.value,
                city: vcEl?.value,
                address: { street: asvEl?.value, number: anvEl?.value },
                zones: [...currentZones],
                brand: (!brandInput || !brandInput.required) ? null : brandInput.value,
                model: (!modelInput || !modelInput.required) ? null : modelInput.value,
                year: (!yearInput || !yearInput.required) ? null : yearInput.value,
                licensePlate: (!licensePlateInput || !licensePlateInput.required) ? null : licensePlateInput.value,
                wantsBackpack: wbEl?.checked,
                // Image handling will be done just before saving to DB if needed, or handle URL if storing elsewhere
                // imageBase64: null // Placeholder if converting before save
             };

             currentDriverData.vehicles.push(vehicleData);
             updateAddedVehiclesList();
             resetVehicleForm();
             if(scrollToFinishBtn) scrollToFinishBtn.classList.remove('hidden');
             return true;
         }

        function resetVehicleForm() { /* ... reset vehicle form helper ... */
             const vehicleDataForm = document.getElementById('vehicle-data-form'); if (vehicleDataForm) vehicleDataForm.reset(); currentZones = []; renderZonePills(); if (vehicleTypeSelect) vehicleTypeSelect.dispatchEvent(new Event('change')); if (currentDriverData?.vehicles && vehicleFormTitle) { const count = currentDriverData.vehicles.length; vehicleFormTitle.textContent = `2. Tu Vehículo (${count + 1})`; } else if (vehicleFormTitle) { vehicleFormTitle.textContent = `2. Tu Vehículo: El Motor de tus Ganancias`;}
        }
        function resetDriverForm() { /* ... reset driver form helper ... */
            const personalDataForm = document.getElementById('personal-data-form'); if (personalDataForm) personalDataForm.reset(); resetVehicleForm(); currentDriverData = null; if(addedVehiclesList) addedVehiclesList.innerHTML = ''; if(vehicleDataContainer) vehicleDataContainer.classList.add('hidden'); if(personalDataContainer) personalDataContainer.classList.remove('hidden'); if(driverIdDisplay) driverIdDisplay.classList.add('hidden'); if(scrollToFinishBtn) scrollToFinishBtn.classList.add('hidden'); const pc = document.getElementById('personal-city'); const vc = document.getElementById('vehicle-city'); if (pc) pc.innerHTML = '<option value="">Provincia primero</option>'; if (vc) vc.innerHTML = '<option value="">Provincia primero</option>';
        }
        function updateAddedVehiclesList() { /* ... update added vehicles list helper ... */
            if (!addedVehiclesList || !currentDriverData?.vehicles) return; addedVehiclesList.innerHTML = ''; if (currentDriverData.vehicles.length > 0) { const title = document.createElement('h4'); title.className = 'text-lg font-semibold text-gray-700 mb-2'; title.textContent = 'Vehículos Agregados:'; addedVehiclesList.appendChild(title); const list = document.createElement('ul'); list.className = 'list-disc list-inside space-y-1'; currentDriverData.vehicles.forEach((v, i) => { const item = document.createElement('li'); item.className = 'text-gray-600'; item.textContent = `Vehículo ${i + 1}: ${v.type || 'N/A'} - ${v.brand || ''} ${v.model || ''} (${v.color || 'N/A'})`; list.appendChild(item); }); addedVehiclesList.appendChild(list); }
        }

        // --- Zone Pill Logic ---
        const updateAddZoneButton = () => { if(addZoneBtn && zoneInput) addZoneBtn.classList.toggle('hidden', zoneInput.value.trim() === ''); };
        const addZone = () => { if (!zoneInput) return; const zoneName = zoneInput.value.trim(); if (zoneName && !currentZones.includes(zoneName)) { currentZones.push(zoneName); renderZonePills(); zoneInput.value = ''; updateAddZoneButton(); zoneInput.classList.remove('invalid-field'); } };
        const removeZone = (zoneName) => { currentZones = currentZones.filter(z => z !== zoneName); renderZonePills(); };
        const renderZonePills = () => { if (!zonePillsContainer) return; zonePillsContainer.innerHTML = ''; currentZones.forEach(zone => { const pill = document.createElement('div'); pill.className = 'flex items-center bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full'; pill.innerHTML = `<span>${zone}</span><button type="button" class="ml-2 text-blue-600 hover:text-blue-800">&times;</button>`; const button = pill.querySelector('button'); if (button) button.addEventListener('click', () => removeZone(zone)); zonePillsContainer.appendChild(pill); }); };

        // --- Base64 Image Conversion ---
        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });


        // --- Initialize Everything After DOM Load ---
        document.addEventListener('DOMContentLoaded', async () => {
             // --- START FIREBASE INIT ---
             try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    try { await signInWithCustomToken(auth, __initial_auth_token); }
                    catch (tokenError) { console.warn("Token sign-in failed, using anonymous.", tokenError); await signInAnonymously(auth); }
                } else { await signInAnonymously(auth); }
                console.log("Firebase initialized.");
            } catch (error) {
                console.error("Firebase init failed:", error);
                showMessage(error.code === 'auth/configuration-not-found' ? "Error Firebase: Autenticación no configurada." : "Error al conectar con DB.", false);
                // Allow non-Firebase dependent parts to continue
            }
            // --- END FIREBASE INIT ---

             // Check for critical elements needed for basic UI interaction
            if (!initialView || !appContent || !backToHomeBtn || !driversSection || !graphsSection) {
                console.error("CRITICAL ERROR: Core layout elements missing!");
                showMessage("Error grave: Faltan elementos de la página. Contacte soporte.", false);
                return; // Stop initialization if core layout is broken
            }


            // --- Attach Event Listeners (with null checks) ---

            // Hero Counter
            const impactCounter = document.getElementById('impact-counter');
            if(impactCounter) { /* ... counter logic ... */
                let count = 0; const target = 15734; const duration = 2000;
                const increment = Math.ceil(target / (duration / 20));
                const updateCount = () => { count += increment; if (count > target) count = target; impactCounter.textContent = count.toLocaleString('es-AR'); if (count < target) setTimeout(updateCount, 20); }; updateCount();
            } else { console.warn("Impact counter not found."); }

            // Activity Feed
            const activityFeed = document.getElementById('activity-feed');
            if(activityFeed) { /* ... activity feed logic ... */
                 const activities = ["Hace 5 min: Campaña de Gaseosa verificada en Rosario.", "Hace 12 min: Nuevo Socio Conductor (Moto) registrado en Palermo.", "Hace 28 min: Campaña de Supermercado verificada en Córdoba.", "Hace 47 min: TallerFlash Campaña de Bicis verificada en Mendoza."]; let activityIndex = 0;
                 const updateActivity = () => {
                     const text = activities[activityIndex];
                     activityFeed.innerHTML = '';
                     text.split('').forEach((char, index) => {
                         const span = document.createElement('span');
                         // [CAMBIO] Si el caracter es un espacio, usa un 'non-breaking space' para forzar su renderizado
                         if (char === ' ') {
                             span.innerHTML = '&nbsp;';
                         } else {
                             span.textContent = char;
                         }
                         span.style.animationDelay = `${index * 0.03}s`;
                         activityFeed.appendChild(span);
                     });
                     activityIndex = (activityIndex + 1) % activities.length;
                 };
                 updateActivity();
                 setInterval(updateActivity, 5000);
            } else { console.warn("Activity feed not found."); }

            // Scroll Arrow
            const scrollArrow = document.getElementById('scroll-arrow');
            if(scrollArrow) { /* ... scroll arrow logic ... */
                scrollArrow.addEventListener('click', (e) => {
                    e.preventDefault();
                    const heroSection = scrollArrow.closest('section');
                    if (heroSection) {
                        const heroHeight = heroSection.offsetHeight;
                        const header = document.querySelector('header'); // Obtenemos el header
                        const headerHeight = header ? header.offsetHeight : 80; // Usamos su altura real o un fallback
                        const targetPosition = heroHeight - headerHeight; // Destino justo debajo del header

                        // [CAMBIO] Llama a la función de scroll personalizada con una duración larga (2500ms)
                        customSmoothScroll(targetPosition, 2500);

                        // [Original] window.scrollTo({ top: heroHeight - 80, behavior: 'smooth' });
                    }
                });
            } else { console.warn("Scroll arrow not found."); }

            // Calculadora de Impacto
            const calcSubmit = document.getElementById('calc-submit');
            const calcResult = document.getElementById('calc-result');
            const calcVehicleSelect = document.getElementById('calc-vehicle');
            const calcMonthsSelect = document.getElementById('calc-months');
            const calcCitySelect = document.getElementById('calc-city');
            const calcResultNumber = document.getElementById('calc-result-number');
            const calcResultCity = document.getElementById('calc-result-city');
            if(calcSubmit && calcResult && calcVehicleSelect && calcMonthsSelect && calcCitySelect && calcResultNumber && calcResultCity) { /* ... calculator logic ... */
                calcSubmit.addEventListener('click', () => { const vehicleMultiplier = parseFloat(calcVehicleSelect.value); const months = parseInt(calcMonthsSelect.value); const city = calcCitySelect.options[calcCitySelect.selectedIndex]?.text; let basePopulation = 50000; if(city) { basePopulation += city.length * 10000; } const weeklyImpact = Math.floor(basePopulation * vehicleMultiplier * 0.1); const totalImpact = weeklyImpact * 4 * months; calcResultNumber.textContent = totalImpact.toLocaleString('es-AR'); calcResultCity.textContent = `Personas vean tu marca en ${city || 'tu ciudad'} (en ${months} ${months > 1 ? 'meses' : 'mes'})`; calcResult.classList.remove('hidden'); });
            } else { console.warn("Calculator elements missing."); }

            // Micro-formulario "Gana Dinero"
            const showDriversCta = document.getElementById('show-drivers-cta');
            const saveDriverLeadCta = document.getElementById('save-driver-lead-cta');
            const driverMicroVehicle = document.getElementById('driver-micro-vehicle');
            const driverMicroEmail = document.getElementById('driver-micro-email');
            if (showDriversCta && saveDriverLeadCta && driverMicroVehicle && driverMicroEmail) {
                 const toggleMicroFormButtons = () => {
                     const vehicle = driverMicroVehicle.value;
                     const email = driverMicroEmail.value;
                     // [MODIFICADO] Show 'Enviar' if EITHER field has a value
                     if (vehicle || email) {
                         showDriversCta.classList.add('hidden');
                         saveDriverLeadCta.classList.remove('hidden');
                     } else {
                         showDriversCta.classList.remove('hidden');
                         saveDriverLeadCta.classList.add('hidden');
                     }
                 };
                 driverMicroVehicle.addEventListener('change', toggleMicroFormButtons);
                 driverMicroEmail.addEventListener('input', toggleMicroFormButtons);

                 // Action when fields are NOT complete (just navigate)
                 showDriversCta.addEventListener('click', (e) => {
                     e.preventDefault();
                     switchSection('drivers');
                 });

                 // Action when fields ARE complete (save then navigate + prefill)
                 saveDriverLeadCta.addEventListener('click', async (e) => {
                     e.preventDefault();
                     const emailValue = driverMicroEmail.value;
                     const vehicleValue = driverMicroVehicle.value;
                     const isEmailValid = emailValue && emailValue.includes('@') && emailValue.includes('.');

                     // Only basic check: require vehicle and a basic email structure
                     if (!vehicleValue || !isEmailValid) {
                         showMessage("Por favor, selecciona un vehículo e ingresa un correo válido.", false);
                         return; // Don't proceed if invalid
                     }


                     if (!db) { showMessage("Error: Database not initialized.", false); return; }

                     try {
                        // [MODIFICADO] Get next LEAD number
                        const leadNumber = await getNextId('LEAD', 'GLOBAL'); // Use 'LEAD' category, 'GLOBAL' code
                        const leadId = `LEAD-${String(leadNumber).padStart(2, '0')}`;

                        const lead = {
                            leadId: leadId, // Add the generated ID to the data
                            vehicleType: vehicleValue,
                            email: emailValue,
                            source: 'micro-form-lead',
                            createdAt: serverTimestamp() // Use Firestore server timestamp
                        };

                         const docRef = doc(db, "driverLeads", leadId); // Use the generated ID as the document name
                         await setDoc(docRef, lead); // Use setDoc with the specific ID

                         // Prepare prefill data for modal
                         const prefillData = { vehicleType: lead.vehicleType, email: lead.email };
                         if (modalOverlay) {
                             modalOverlay.dataset.prefill = JSON.stringify(prefillData);
                             modalOverlay.dataset.redirectTarget = 'drivers'; // Set target for redirection
                         }
                         showSuccessModal("¡Recibido!", "Gracias por tu interés. Completa el resto de tus datos.", true); // Redirect flag is true

                         // Resetting is now handled by handleModalClose

                     } catch (error) {
                         console.error("Error writing lead:", error);
                         showMessage("Error al guardar tus datos iniciales.", false);
                     }
                 });
            } else { console.warn("Micro-form elements missing."); }


            // Botón "Registra tu Taller"
            const showGraphsCta = document.getElementById('show-graphs-cta');
            if(showGraphsCta) { /* ... show graphs logic ... */
                 showGraphsCta.addEventListener('click', (e) => { e.preventDefault(); switchSection('graphs'); });
            } else { console.warn("Show graphs button missing."); }

            // Mobile Menu Toggle
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            if(mobileMenuButton && mobileMenu) { /* ... mobile menu toggle ... */
                 mobileMenuButton.addEventListener('click', () => { mobileMenu.classList.toggle('hidden'); });
            } else { console.warn("Mobile menu elements missing."); }

            // Navigation Links
            const navLinks = [ /* ... nav links array ... */
                { id: 'register-driver-nav', section: 'drivers' }, { id: 'register-graph-nav', section: 'graphs' }, { id: 'register-driver-nav-mobile', section: 'drivers' }, { id: 'register-graph-nav-mobile', section: 'graphs' }, { id: 'footer-register-driver', section: 'drivers' }, { id: 'footer-register-graph', section: 'graphs' }
            ];
            navLinks.forEach(link => { /* ... attach nav link listeners ... */
                const element = document.getElementById(link.id); if (element) { element.addEventListener('click', (e) => { e.preventDefault(); switchSection(link.section); if(mobileMenu && !mobileMenu.classList.contains('hidden')) { mobileMenu.classList.add('hidden'); } }); } else { console.warn(`Nav link '${link.id}' not found!`); }
            });

            // Back to Home Button
            if (backToHomeBtn) backToHomeBtn.addEventListener('click', returnToInitialView); else { console.warn("Back button not found."); }


            // Form 1: Personal Data
            const personalDataForm = document.getElementById('personal-data-form');
            if (personalDataForm) { /* ... personal data form submit logic ... */
                 personalDataForm.addEventListener('submit', async (e) => {
                     e.preventDefault();
                     if (!validateForm(personalDataForm)) {
                         showMessage("Completa los campos requeridos.", false);
                         return;
                     }
                     const fullNameEl = document.getElementById('full-name');
                     const provinceEl = document.getElementById('province');
                     const personalCityEl = document.getElementById('personal-city');
                     const addressStreetEl = document.getElementById('address-street');
                     const addressNumberEl = document.getElementById('address-number');
                     const phoneEl = document.getElementById('phone');
                     const emailEl = document.getElementById('email'); // Already exists

                     currentDriverData = {
                         fullName: fullNameEl?.value,
                         province: provinceEl?.value,
                         city: personalCityEl?.value,
                         address: { street: addressStreetEl?.value, number: addressNumberEl?.value },
                         phone: phoneEl?.value,
                         email: emailEl?.value, // Use existing email value
                         vehicles: [],
                         createdAt: serverTimestamp() // Use Firestore server timestamp
                     };

                     if(personalDataContainer) personalDataContainer.classList.add('hidden');
                     if(vehicleDataContainer) vehicleDataContainer.classList.remove('hidden');
                     resetVehicleForm(); // Reset vehicle form for the first vehicle
                 });
            } else { console.warn("Personal data form not found."); }



            // Form 2: Vehicle Data Listeners (Type Change, Zone Logic, Add, Finish, Scroll)
            if (vehicleTypeSelect) { /* ... vehicle type change logic ... */
                 vehicleTypeSelect.addEventListener('change', () => { const type = vehicleTypeSelect.value; const isBici = (type === 'BICI'); const isMoto = (type === 'MOTO'); [brandContainer, modelContainer, yearContainer, licensePlateContainer].forEach(el => { if (el) el.classList.toggle('hidden', isBici); }); if (backpackOptionContainer) backpackOptionContainer.classList.toggle('hidden', !isMoto && !isBici); [brandInput, modelInput, yearInput, licensePlateInput].forEach(input => { if (input) input.required = !isBici; }); });
            }
            if(zoneInput) zoneInput.addEventListener('input', updateAddZoneButton);
            if (addZoneBtn) addZoneBtn.addEventListener('click', addZone);
            if (zoneInput) zoneInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); addZone(); } });
            if (addVehicleBtn) { /* ... add vehicle btn listener ... */
                 addVehicleBtn.addEventListener('click', () => { if (!saveVehicleData()) { /* Message shown inside saveVehicleData */ } });
            }

            if (finishVehiclesBtn) {
                 finishVehiclesBtn.addEventListener('click', async () => {
                    if (!db) { showMessage("Error: DB no inicializada.", false); return; }
                    if (!currentDriverData) { showMessage("Error: Datos personales no guardados.", false); if(personalDataContainer) personalDataContainer.classList.remove('hidden'); if(vehicleDataContainer) vehicleDataContainer.classList.add('hidden'); return; }
                    if (!currentDriverData.vehicles) currentDriverData.vehicles = [];

                     // Check if there is data in the current vehicle form that hasn't been added yet
                     const vehicleDataForm = document.getElementById('vehicle-data-form');
                     let hasUnsavedData = false;
                     if (vehicleDataForm) {
                         const inputs = vehicleDataForm.querySelectorAll('input:not([type="file"]), select');
                         inputs.forEach(input => {
                             if (input.value && input.value.trim() !== '') hasUnsavedData = true;
                         });
                         if (currentZones.length > 0) hasUnsavedData = true; // Also check zones
                     }


                    // Attempt to save the current form data if it exists
                    if (hasUnsavedData) {
                        const saved = saveVehicleData();
                        if (!saved) {
                             // If saving the last vehicle fails (e.g., validation), stop here. Message is shown in saveVehicleData.
                             return;
                        }
                    }


                     // Now check if *any* vehicle has been added
                    if (currentDriverData.vehicles.length === 0) {
                        showMessage("Debe agregar al menos un vehículo antes de finalizar.", false);
                        return;
                    }

                    // Proceed to save everything to Firestore
                    try {
                        // [MODIFICADO] Generar el ID personalizado PRIMERO
                        const provinceCode = getProvinceCode(currentDriverData.province);
                        const cityAbbr = getCityAbbreviation(currentDriverData.city);
                        const driverNumber = await getNextId('driver', cityAbbr); // Get next number for that city
                        const newId = `CH-${provinceCode}-${cityAbbr}-${String(driverNumber).padStart(2, '0')}`;
                        
                        // [MODIFICADO] Crear la referencia del documento con el ID personalizado
                        const driverRef = doc(db, "drivers", newId); 

                         // [MODIFICADO] Procesar imágenes Y generar vehicleId global
                         const vehiclesWithImagesAndIds = await Promise.all(currentDriverData.vehicles.map(async (vehicle, index) => {
                             const imageInput = document.getElementById('image'); 
                             const file = imageInput?.files?.[0]; 
                             let imageBase64 = null;
                             if(file && index === currentDriverData.vehicles.length -1) { 
                                try { imageBase64 = await toBase64(file); } catch (e) { console.error("Image conversion error:", e); }
                             }
                             
                             // [NUEVO] Generar vehicleId global secuencial
                             const vehicleNumber = await getNextId('vehicle', 'GLOBAL'); 
                             const vehicleId = `VE-${String(vehicleNumber).padStart(2, '0')}`;

                             return { ...vehicle, imageBase64, vehicleId }; // Add image and ID
                         }));

                         // [MODIFICADO] Preparar datos finales para guardar
                         const dataToSave = { 
                             ...currentDriverData, 
                             vehicles: vehiclesWithImagesAndIds, // Usar vehículos procesados
                             driverId: newId // Guardar también el ID como un campo interno
                         }; 

                        await setDoc(driverRef, dataToSave); // Guardar todos los datos con el ID personalizado

                        // [ELIMINADO] Ya no se actualiza el ID después, se crea con él.
                        // await setDoc(driverRef, { driverId: newId }, { merge: true }); 

                        if(generatedIdElement) generatedIdElement.textContent = newId;
                        if(driverIdDisplay) driverIdDisplay.classList.remove('hidden');
                        if(modalOverlay) modalOverlay.dataset.redirectTarget = 'home'; // Set target for default home redirect
                        showSuccessModal("¡Registro Completo!", `Tu ID es ${newId}. Nos pondremos en contacto.`, true);
                        resetDriverForm(); // Clear forms after successful save
                    } catch (error) {
                        console.error("Error writing driver:", error);
                        showMessage("Error al guardar en la base de datos.", false);
                    }
                });
            }

            if (scrollToFinishBtn) { /* ... scroll to finish btn listener ... */
                 scrollToFinishBtn.addEventListener('click', () => { if (finishVehiclesBtn) { finishVehiclesBtn.scrollIntoView({ behavior: 'smooth', block: 'center' }); finishVehiclesBtn.classList.add('highlight-finish-btn'); setTimeout(() => { finishVehiclesBtn.classList.remove('highlight-finish-btn'); }, 3000); } });
            }

            // Form 3: Graphs
            const graphsForm = document.getElementById('graphs-form');
            const operatingHoursContainer = document.getElementById('operating-hours-container');
            const applyAllHoursCheckbox = document.getElementById('apply-all-hours');
            if (operatingHoursContainer) { /* ... operating hours setup ... */
                const days = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo']; days.forEach(day => { const dayId = day.toLowerCase(); const row = document.createElement('div'); row.className = 'flex flex-col sm:flex-row items-center gap-2 sm:gap-4'; row.innerHTML = `<div class="flex items-center w-full sm:w-1/3"><input id="check-${dayId}" name="check-${dayId}" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"><label for="check-${dayId}" class="ml-2 block text-gray-700 font-medium">${day}</label></div><div class="flex items-center gap-2 w-full sm:w-2/3"><input type="time" id="time-from-${dayId}" name="time-from-${dayId}" class="w-1/2 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" disabled><span class="text-gray-500">a</span><input type="time" id="time-to-${dayId}" name="time-to-${dayId}" class="w-1/2 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" disabled></div>`; operatingHoursContainer.appendChild(row); const cb = row.querySelector(`#check-${dayId}`); const from = row.querySelector(`#time-from-${dayId}`); const to = row.querySelector(`#time-to-${dayId}`); if (cb && from && to) { cb.addEventListener('change', (e) => { const isChecked = e.target.checked; from.disabled = !isChecked; to.disabled = !isChecked; }); } });
            } else { console.warn("Operating hours container not found."); }

            if (applyAllHoursCheckbox && operatingHoursContainer) { /* ... apply all hours logic ... */
                applyAllHoursCheckbox.addEventListener('change', (e) => { if (!e.target.checked) return; const days = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo']; const firstDay = days[0].toLowerCase(); const fromEl = document.getElementById(`time-from-${firstDay}`); const toEl = document.getElementById(`time-to-${firstDay}`); const checkEl = document.getElementById(`check-${firstDay}`); if (!fromEl || !toEl || !checkEl) { showMessage("Error: Elementos Lunes no encontrados.", false); e.target.checked = false; return; } const fromVal = fromEl.value; const toVal = toEl.value; const isChecked = checkEl.checked; if (!isChecked || !fromVal || !toVal) { showMessage("Completa horario Lunes.", false); e.target.checked = false; return; } days.slice(1).forEach(day => { const id = day.toLowerCase(); const c = document.getElementById(`check-${id}`); const f = document.getElementById(`time-from-${id}`); const t = document.getElementById(`time-to-${id}`); if(c) c.checked = true; if(f) { f.value = fromVal; f.disabled = false; } if(t) { t.value = toVal; t.disabled = false; } }); });
            } else { console.warn("Apply all hours checkbox or container missing."); }

             if (graphsForm) { /* ... graphs form submit logic ... */
                 graphsForm.addEventListener('submit', async (e) => {
                     e.preventDefault();
                     if (!db) { showMessage("Error: DB no inicializada.", false); return; }
                     const commitEl = document.getElementById('service-commitment');
                     const constraints = commitEl ? { 'service-commitment': (v) => commitEl.checked } : {};
                      
                      // [MODIFICADO] 'validateForm' ahora hace focus automáticamente si falla.
                      let isValid = validateForm(graphsForm, constraints); // Initial validation
                      if (!isValid) {
                          showMessage("Por favor, complete todos los campos obligatorios.", false);
                          return; // Salir si la validación principal falla
                      }

                     const operatingHours = {};
                     const days = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'];
                     let daySelected = false;
                     let firstInvalidHourField = null; // [NUEVO]
                     
                     days.forEach(day => {
                         const id = day.toLowerCase();
                         const check = document.getElementById(`check-${id}`);
                         if (check?.checked) {
                             daySelected = true;
                             const from = document.getElementById(`time-from-${id}`)?.value;
                             const to = document.getElementById(`time-to-${id}`)?.value;
                             if(from && to) {
                                 operatingHours[day] = { from, to };
                             } else {
                                // If checked but times are missing, invalidate form
                                isValid = false;
                                const fromInput = document.getElementById(`time-from-${id}`);
                                const toInput = document.getElementById(`time-to-${id}`);
                                if(fromInput && !fromInput.value) {
                                    fromInput.classList.add('invalid-field');
                                    if (!firstInvalidHourField) firstInvalidHourField = fromInput; // [NUEVO]
                                }
                                if(toInput && !toInput.value) {
                                    toInput.classList.add('invalid-field');
                                    if (!firstInvalidHourField) firstInvalidHourField = toInput; // [NUEVO]
                                }
                             }
                         }
                     });
                     
                     // [NUEVO] Hacer focus si un campo de hora es inválido
                     if (firstInvalidHourField) {
                         firstInvalidHourField.focus();
                         firstInvalidHourField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                     }

                     // Re-check validity after hour check
                     if (!isValid) {
                         showMessage("Por favor, complete los horarios para los días seleccionados.", false);
                         return;
                     }

                     if (!daySelected) {
                         showMessage("Selecciona al menos un día de atención y completa su horario.", false);
                         return;
                     }

                     const getQuote = (form, name) => form.elements[name]?.value || '';
                     const priceQuotes = { /* ... price quote object structure ... */ autoCompleto:{from:document.getElementById('price-from-auto-completo')?.value,to:document.getElementById('price-to-auto-completo')?.value,vinyl:getQuote(graphsForm,'vinyl-auto-completo'),time:getQuote(graphsForm,'installation-time-auto-completo')}, capot:{from:document.getElementById('price-from-capot')?.value,to:document.getElementById('price-to-capot')?.value,vinyl:getQuote(graphsForm,'vinyl-capot'),time:getQuote(graphsForm,'installation-time-capot')}, puertas:{from:document.getElementById('price-from-puertas')?.value,to:document.getElementById('price-to-puertas')?.value,vinyl:getQuote(graphsForm,'vinyl-puertas'),time:getQuote(graphsForm,'installation-time-puertas')}, baul:{from:document.getElementById('price-from-baul')?.value,to:document.getElementById('price-to-baul')?.value,vinyl:getQuote(graphsForm,'vinyl-baul'),time:getQuote(graphsForm,'installation-time-baul')}, luneta:{from:document.getElementById('price-from-luneta')?.value,to:document.getElementById('price-to-luneta')?.value,vinyl:getQuote(graphsForm,'vinyl-luneta'),time:getQuote(graphsForm,'installation-time-luneta')}, moto:{from:document.getElementById('price-from-moto')?.value,to:document.getElementById('price-to-moto')?.value,vinyl:getQuote(graphsForm,'vinyl-moto'),time:getQuote(graphsForm,'installation-time-moto')}, bici:{from:document.getElementById('price-from-bici')?.value,to:document.getElementById('price-to-bici')?.value,vinyl:getQuote(graphsForm,'vinyl-bici'),time:getQuote(graphsForm,'installation-time-bici')}, mochila:{from:document.getElementById('price-from-mochila')?.value,to:document.getElementById('price-to-mochila')?.value,vinyl:getQuote(graphsForm,'vinyl-mochila'),time:getQuote(graphsForm,'installation-time-mochila')} };
                     const gnEl = document.getElementById('graph-name');
                     const mnEl = document.getElementById('manager-name');
                     const gpEl = document.getElementById('graph-phone');
                     const geEl = document.getElementById('graph-email');
                     const gprovEl = document.getElementById('graphs-province');
                     const glocEl = document.getElementById('graph-location');
                     const gasEl = document.getElementById('graph-address-street');
                     const ganEl = document.getElementById('graph-address-number');
                     const wcEl = document.getElementById('weekly-capacity');

                     const graphData = {
                         graphName: gnEl?.value,
                         managerName: mnEl?.value,
                         phone: gpEl?.value,
                         email: geEl?.value,
                         province: gprovEl?.value,
                         city: glocEl?.value,
                         address: { street: gasEl?.value, number: ganEl?.value },
                         weeklyCapacity: wcEl?.value,
                         operatingHours: operatingHours,
                         priceQuotes: priceQuotes,
                         serviceCommitment: commitEl?.checked,
                         createdAt: serverTimestamp() // Use Firestore server timestamp
                     };

                     try {
                         // [MODIFICADO] Generar el ID personalizado PRIMERO
                         const provinceCode = getProvinceCode(graphData.province);
                         const cityAbbr = getCityAbbreviation(graphData.city);
                         const graphNumber = await getNextId('graph', cityAbbr); // Get next number for that city
                         const newId = `GF-${provinceCode}-${cityAbbr}-${String(graphNumber).padStart(2, '0')}`;
                         
                         // [MODIFICADO] Crear la referencia del documento con el ID personalizado
                         const graphRef = doc(db, "graphs", newId);
                         
                         // [MODIFICADO] Preparar datos finales para guardar
                         const dataToSave = {
                             ...graphData,
                             graphId: newId // Guardar también el ID como un campo interno
                         };

                         await setDoc(graphRef, dataToSave); // Guardar todos los datos con el ID personalizado

                         // [ELIMINADO] Ya no se actualiza el ID después, se crea con él.
                         // await setDoc(graphRef, { graphId: newId }, { merge: true }); 

                         if (generatedGraphIdElement) generatedGraphIdElement.textContent = newId;
                         if (graphIdDisplay) graphIdDisplay.classList.remove('hidden');
                         if(modalOverlay) modalOverlay.dataset.redirectTarget = 'home'; // Set target for default home redirect
                         showSuccessModal("¡Taller Registrado!", `ID: ${newId}. Nos pondremos en contacto.`, true);
                         graphsForm.reset();
                         days.forEach(day => {
                            const id = day.toLowerCase();
                            const c = document.getElementById(`check-${id}`);
                            const f = document.getElementById(`time-from-${id}`);
                            const t = document.getElementById(`time-to-${id}`);
                            if(c) c.checked = false;
                            if(f) { f.value = ''; f.disabled = true; }
                            if(t) { t.value = ''; t.disabled = true; }
                         });
                     } catch (error) {
                         console.error("Error writing graph:", error);
                         showMessage("Error al guardar en la base de datos.", false);
                     }
                 });
            } else { console.warn("Graphs form not found."); }


            // Initialize all province/city selects
            setupProvinceCitySelects('calc-province', 'calc-city');
            setupProvinceCitySelects('province', 'personal-city');
            setupProvinceCitySelects('vehicle-province', 'vehicle-city');
            setupProvinceCitySelects('graphs-province', 'graph-location');

            console.log("DOM fully loaded and parsed, event listeners attached.");

        }); // End DOMContentLoaded
    </script>
</body>
</html>







